"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5272],{4331:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>d});var r=o(758);const n={},i=r.createContext(n);function s(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(i.Provider,{value:t},e.children)}},4592:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>m,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"migrating-from-automerge-2-to-automerge-3","title":"Migrating from Automerge 2 to Automerge 3","description":"Automerge 3 is a major update to the Automerge library which enormously reduces memory usage and in many cases improves performance. It is however, almost entirely backwards compatible with Automerge 2. The main difference is that we have deprecated the old Text based API for collaborative string.","source":"@site/docs/migrating-from-automerge-2-to-automerge-3.md","sourceDirName":".","slug":"/migrating-from-automerge-2-to-automerge-3","permalink":"/docs/migrating-from-automerge-2-to-automerge-3","draft":false,"unlisted":false,"editUrl":"https://github.com/automerge/automerge.github.io/edit/main/docs/migrating-from-automerge-2-to-automerge-3.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Next Steps","permalink":"/docs/tutorial/next-steps"},"next":{"title":"Using Automerge with LLMs","permalink":"/docs/using-automerge-with-llms"}}');var n=o(6070),i=o(4331);const s={sidebar_position:2},d="Migrating from Automerge 2 to Automerge 3",a={},c=[{value:"Steps to upgrade",id:"steps-to-upgrade",level:2},{value:"Updating <code>Text</code> to <code>string</code>",id:"updating-text-to-string",level:3},{value:"Updating <code>string</code> to <code>ImmutableString</code>",id:"updating-string-to-immutablestring",level:3}];function l(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"migrating-from-automerge-2-to-automerge-3",children:"Migrating from Automerge 2 to Automerge 3"})}),"\n",(0,n.jsxs)(t.p,{children:["Automerge 3 is a major update to the Automerge library which enormously reduces memory usage and in many cases improves performance. It is however, almost entirely backwards compatible with Automerge 2. The main difference is that we have deprecated the old ",(0,n.jsx)(t.code,{children:"Text"})," based API for collaborative string."]}),"\n",(0,n.jsxs)(t.p,{children:["In Automerge 2 we had two APIs for collaborative text. In one API, we represented collaborative text using a class called ",(0,n.jsx)(t.code,{children:"Text"}),", which had methods on it for mutating the string. We eventually deprecated this API and introduced a new API in which collaborative text was represented using a plain ",(0,n.jsx)(t.code,{children:"string"})," and you use methods like ",(0,n.jsx)(t.code,{children:"Automerge.splice"})," and ",(0,n.jsx)(t.code,{children:"Automerge.updateText"})," to modify those strings. Accessing the new API was done by importing the ",(0,n.jsx)(t.code,{children:"next"})," API of Automerge, like so:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import { next as Automerge } from "@automerge/automerge"\n'})}),"\n",(0,n.jsxs)(t.p,{children:["In Automerge 3 the old ",(0,n.jsx)(t.code,{children:"Text"})," API is no longer available. All collaborative strings are represented as ",(0,n.jsx)(t.code,{children:"string"}),"s. The ",(0,n.jsx)(t.code,{children:"next"})," module is still available (to avoid breaking codebases which use it) but it just re-exports the ",(0,n.jsx)(t.code,{children:"Automerge"})," module."]}),"\n",(0,n.jsx)(t.h2,{id:"steps-to-upgrade",children:"Steps to upgrade"}),"\n",(0,n.jsxs)(t.p,{children:["If you are not using the old ",(0,n.jsx)(t.code,{children:"Text"})," API (you import Automerge using ",(0,n.jsx)(t.code,{children:'import { next as Automerge } from "@automerge/automerge"'}),"), then you can just change your imports to ",(0,n.jsx)(t.code,{children:'import * as Automerge from "@automerge/automerge"'})," and you are done. You don't even ",(0,n.jsx)(t.em,{children:"have"})," to do this, but we recommend it as the ",(0,n.jsx)(t.code,{children:"next"})," module is now deprecated."]}),"\n",(0,n.jsxs)(t.p,{children:["If you ",(0,n.jsx)(t.em,{children:"are"})," using the old ",(0,n.jsx)(t.code,{children:"Text"})," API then you will need to make the following changes:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Anywhere your code expects to work with a ",(0,n.jsx)(t.code,{children:"Text"})," class, update it to use a ",(0,n.jsx)(t.code,{children:"string"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Anywhere your code expects to work with a ",(0,n.jsx)(t.code,{children:"string"}),", update it to use an ",(0,n.jsx)(t.code,{children:"ImmutableString"})]}),"\n"]}),"\n",(0,n.jsxs)(t.h3,{id:"updating-text-to-string",children:["Updating ",(0,n.jsx)(t.code,{children:"Text"})," to ",(0,n.jsx)(t.code,{children:"string"})]}),"\n",(0,n.jsx)(t.p,{children:"Here's an example. If your old code looks like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import * as Automerge from "@automerge/automerge"\n\nlet doc = Automerge.from({\n    content: new Automerge.Text()\n})\n\ndoc = Automerge.change(doc, d => {\n    d.content.insertAt(0, "Hello ")\n})\n'})}),"\n",(0,n.jsx)(t.p,{children:"You would change it to this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import * as Automerge from "@automerge/automerge"\n\nlet doc = Automerge.from({\n    content: ""\n})\n\ndoc = Automerge.change(doc, d => {\n    Automerge.splice(d, ["content"], 0, 0, "Hello")\n})\n'})}),"\n",(0,n.jsxs)(t.h3,{id:"updating-string-to-immutablestring",children:["Updating ",(0,n.jsx)(t.code,{children:"string"})," to ",(0,n.jsx)(t.code,{children:"ImmutableString"})]}),"\n",(0,n.jsx)(t.p,{children:"If your old code looks like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import * as Automerge from "@automerge/automerge"\nlet doc = Automerge.from({\n    content: "Hello world"\n})\ndoc = Automerge.change(doc, d => {\n    d.content = "Goodbye world"\n})\n'})}),"\n",(0,n.jsx)(t.p,{children:"You would change it to this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import * as Automerge from "@automerge/automerge"\nlet doc = Automerge.from({\n    content: new Automerge.ImmutableString("Hello world")\n})\ndoc = Automerge.change(doc, d => {\n    d.content = new Automerge.ImmutableString("Goodbye world")\n})\n'})})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);