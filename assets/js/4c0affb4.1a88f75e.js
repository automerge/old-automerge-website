"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7783],{4331:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>s});var o=n(758);const r={},i=o.createContext(r);function c(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(i.Provider,{value:t},e.children)}},6423:(e,t,n)=>{n.d(t,{A:()=>r});n(758);var o=n(6070);function r(e){let{children:t}=e;return(0,o.jsxs)("div",{className:"exercise",children:[(0,o.jsx)("div",{className:"exercise-header",children:(0,o.jsx)("h3",{children:"Exercise"})}),(0,o.jsx)("div",{className:"exercise-content",children:t})]})}},7112:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>c,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"tutorial/multi-device-root-doc","title":"Multi Device Root Document","description":"Syncing Across Devices","source":"@site/docs/tutorial/09-multi-device-root-doc.mdx","sourceDirName":"tutorial","slug":"/tutorial/multi-device-root-doc","permalink":"/docs/tutorial/multi-device-root-doc","draft":false,"unlisted":false,"editUrl":"https://github.com/automerge/automerge.github.io/edit/main/docs/tutorial/09-multi-device-root-doc.mdx","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"Multi Device Root Document"},"sidebar":"tutorialSidebar","previous":{"title":"Persisting the Root Document","permalink":"/docs/tutorial/persist-root-doc"},"next":{"title":"Next Steps","permalink":"/docs/tutorial/next-steps"}}');var r=n(6070),i=n(4331);n(9821),n(6423),n(8628);const c={title:"Multi Device Root Document"},s=void 0,l={},a=[{value:"Syncing Across Devices",id:"syncing-across-devices",level:2},{value:"Checking it works",id:"checking-it-works",level:3}];function d(e){const t={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"syncing-across-devices",children:"Syncing Across Devices"}),"\n",(0,r.jsxs)(t.p,{children:["We have a root document that contains all our task lists, but right now it's only accessible in the browser where we created it. It would be very useful to be able to share this root document between our devices. To achieve this we'll need to share our root document ID. First, let's add a method to update the root document ID in ",(0,r.jsx)(t.code,{children:"src/rootDoc.ts"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",metastring:'title="src/rootDoc.ts"',children:'import { AutomergeUrl, Repo } from "@automerge/react";\n\nconst ROOT_DOC_URL_KEY = "root-doc-url";\n\nexport type RootDocument = {\n  taskLists: AutomergeUrl[];\n};\n\n// highlight-start\nexport const setRootDocUrl = (url: AutomergeUrl): void => {\n  localStorage.setItem(ROOT_DOC_URL_KEY, url);\n};\n// highlight-end\n\nexport const getOrCreateRoot = (repo: Repo): AutomergeUrl => {\n  // Check if we already have a root document\n  const existingId = localStorage.getItem(ROOT_DOC_URL_KEY);\n  if (existingId) {\n    return existingId as AutomergeUrl;\n  }\n\n  // Otherwise create one and (synchronously) store it\n  const root = repo.create<RootDocument>({ taskLists: [] });\n  localStorage.setItem(ROOT_DOC_URL_KEY, root.url);\n  return root.url;\n};\n'})}),"\n",(0,r.jsx)(t.p,{children:"Now, let's add a component to handle the export and import of the root document ID."}),"\n",(0,r.jsxs)(t.p,{children:["Create a new file ",(0,r.jsx)(t.code,{children:"src/components/SyncControls.tsx"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'import { useState } from "react";\nimport { type AutomergeUrl, isValidAutomergeUrl } from "@automerge/react";\nimport { setRootDocUrl } from "../rootDoc";\n\ninterface SyncControlsProps {\n  docUrl: AutomergeUrl;\n}\n\nexport const SyncControls: React.FC<SyncControlsProps> = ({ docUrl }) => {\n  const [showImportDialog, setShowImportDialog] = useState(false);\n  const [importUrl, setImportUrl] = useState("");\n  const [error, setError] = useState("");\n\n  const handleExport = () => {\n    navigator.clipboard.writeText(docUrl);\n  };\n\n  const handleImport = () => {\n    if (!isValidAutomergeUrl(importUrl)) {\n      setError("Invalid Automerge URL");\n      return;\n    }\n\n    setRootDocUrl(importUrl);\n    window.location.reload();\n  };\n\n  const closeDialog = () => {\n    setShowImportDialog(false);\n    setImportUrl("");\n    setError("");\n  };\n\n  return (\n    <div className="sync-controls">\n      <button onClick={handleExport}>Copy account token</button>\n      <button onClick={() => setShowImportDialog(true)}>\n        Import account token\n      </button>\n\n      {showImportDialog && (\n        <dialog open>\n          <article>\n            <header>\n              <h3>Import your account token</h3>\n            </header>\n            <input\n              type="text"\n              value={importUrl}\n              onChange={(e) => {\n                setImportUrl(e.target.value);\n                setError("");\n              }}\n              placeholder="Paste your account token URL here"\n            />\n            {error && <p style={{ color: "red" }}>{error}</p>}\n            <footer>\n              <button onClick={handleImport}>Import</button>\n              <button onClick={closeDialog}>Cancel</button>\n            </footer>\n          </article>\n        </dialog>\n      )}\n    </div>\n  );\n};\n'})}),"\n",(0,r.jsx)(t.p,{children:'This component provides buttons to export the current root document ID to the clipboard and to import a new root document ID. When the user clicks "Copy account token", the current document URL is copied to the clipboard. When they click "Import account token", a dialog appears where they can paste a new root document ID. When the root document is pasted we update the stored root document ID and reload the page to reflect the changes.'}),"\n",(0,r.jsx)(t.h3,{id:"checking-it-works",children:"Checking it works"}),"\n",(0,r.jsx)(t.p,{children:'Open the application and create a few task lists, then click the "Copy account token" button. This will copy the root document ID to your clipboard. Now, open a new browser, or an incognito window, and paste the copied URL into the address bar. You should see the same task lists and items you created earlier.'})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8628:(e,t,n)=>{n.d(t,{A:()=>r});n(758);var o=n(6070);function r(e){let{children:t}=e;return(0,o.jsxs)("div",{className:"solution",children:[(0,o.jsx)("div",{className:"solution-header",children:(0,o.jsx)("h4",{children:"Solution"})}),(0,o.jsx)("div",{className:"solution-content",children:t})]})}},9821:(e,t,n)=>{n.d(t,{A:()=>T});var o=n(758),r=n(6070);function i(e){const{mdxAdmonitionTitle:t,rest:n}=function(e){const t=o.Children.toArray(e),n=t.find((e=>o.isValidElement(e)&&"mdxAdmonitionTitle"===e.type)),i=t.filter((e=>e!==n)),c=n?.props.children;return{mdxAdmonitionTitle:c,rest:i.length>0?(0,r.jsx)(r.Fragment,{children:i}):null}}(e.children),i=e.title??t;return{...e,...i&&{title:i},children:n}}var c=n(3526),s=n(1311),l=n(7967);const a="admonition_BudP",d="admonitionHeading_3rRN",u="admonitionIcon_GUtA",h="admonitionContent_Y5R8";function m(e){let{type:t,className:n,children:o}=e;return(0,r.jsx)("div",{className:(0,c.A)(l.G.common.admonition,l.G.common.admonitionType(t),a,n),children:o})}function p(e){let{icon:t,title:n}=e;return(0,r.jsxs)("div",{className:d,children:[(0,r.jsx)("span",{className:u,children:t}),n]})}function x(e){let{children:t}=e;return t?(0,r.jsx)("div",{className:h,children:t}):null}function g(e){const{type:t,icon:n,title:o,children:i,className:c}=e;return(0,r.jsxs)(m,{type:t,className:c,children:[o||n?(0,r.jsx)(p,{title:o,icon:n}):null,(0,r.jsx)(x,{children:i})]})}function f(e){return(0,r.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})})}const v={icon:(0,r.jsx)(f,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.note",description:"The default label used for the Note admonition (:::note)",children:"note"})};function j(e){return(0,r.jsx)(g,{...v,...e,className:(0,c.A)("alert alert--secondary",e.className),children:e.children})}function w(e){return(0,r.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})})}const y={icon:(0,r.jsx)(w,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.tip",description:"The default label used for the Tip admonition (:::tip)",children:"tip"})};function D(e){return(0,r.jsx)(g,{...y,...e,className:(0,c.A)("alert alert--success",e.className),children:e.children})}function b(e){return(0,r.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})})}const C={icon:(0,r.jsx)(b,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.info",description:"The default label used for the Info admonition (:::info)",children:"info"})};function k(e){return(0,r.jsx)(g,{...C,...e,className:(0,c.A)("alert alert--info",e.className),children:e.children})}function N(e){return(0,r.jsx)("svg",{viewBox:"0 0 16 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})})}const A={icon:(0,r.jsx)(N,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.warning",description:"The default label used for the Warning admonition (:::warning)",children:"warning"})};function R(e){return(0,r.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})})}const I={icon:(0,r.jsx)(R,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.danger",description:"The default label used for the Danger admonition (:::danger)",children:"danger"})};const U={icon:(0,r.jsx)(N,{}),title:(0,r.jsx)(s.A,{id:"theme.admonition.caution",description:"The default label used for the Caution admonition (:::caution)",children:"caution"})};const S={...{note:j,tip:D,info:k,warning:function(e){return(0,r.jsx)(g,{...A,...e,className:(0,c.A)("alert alert--warning",e.className),children:e.children})},danger:function(e){return(0,r.jsx)(g,{...I,...e,className:(0,c.A)("alert alert--danger",e.className),children:e.children})}},...{secondary:e=>(0,r.jsx)(j,{title:"secondary",...e}),important:e=>(0,r.jsx)(k,{title:"important",...e}),success:e=>(0,r.jsx)(D,{title:"success",...e}),caution:function(e){return(0,r.jsx)(g,{...U,...e,className:(0,c.A)("alert alert--warning",e.className),children:e.children})}}};function T(e){const t=i(e),n=(o=t.type,S[o]||(console.warn(`No admonition component found for admonition type "${o}". Using Info as fallback.`),S.info));var o;return(0,r.jsx)(n,{...t})}}}]);