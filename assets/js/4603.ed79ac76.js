/*! For license information please see 4603.ed79ac76.js.LICENSE.txt */
(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4603],{11:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wrapXOFConstructorWithOpts=t.wrapConstructorWithOpts=t.wrapConstructor=t.Hash=t.nextTick=t.swap32IfBE=t.byteSwapIfBE=t.swap8IfBE=t.isLE=void 0,t.isBytes=r,t.anumber=o,t.abytes=i,t.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.createHasher");o(e.outputLen),o(e.blockLen)},t.aexists=function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},t.aoutput=function(e,t){i(e);const s=t.outputLen;if(e.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)},t.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},t.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},t.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},t.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},t.rotr=function(e,t){return e<<32-t|e>>>t},t.rotl=function(e,t){return e<<t|e>>>32-t>>>0},t.byteSwap=a,t.byteSwap32=c,t.bytesToHex=function(e){if(i(e),h)return e.toHex();let t="";for(let s=0;s<e.length;s++)t+=d[e[s]];return t},t.hexToBytes=function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);if(h)return Uint8Array.fromHex(e);const t=e.length,s=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(s);for(let r=0,o=0;r<s;r++,o+=2){const t=l(e.charCodeAt(o)),s=l(e.charCodeAt(o+1));if(void 0===t||void 0===s){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}n[r]=16*t+s}return n},t.asyncLoop=async function(e,s,n){let r=Date.now();for(let o=0;o<e;o++){n(o);const e=Date.now()-r;e>=0&&e<s||(await(0,t.nextTick)(),r+=e)}},t.utf8ToBytes=f,t.bytesToUtf8=function(e){return(new TextDecoder).decode(e)},t.toBytes=p,t.kdfInputToBytes=function(e){"string"==typeof e&&(e=f(e));return i(e),e},t.concatBytes=function(...e){let t=0;for(let n=0;n<e.length;n++){const s=e[n];i(s),t+=s.length}const s=new Uint8Array(t);for(let n=0,r=0;n<e.length;n++){const t=e[n];s.set(t,r),r+=t.length}return s},t.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("options should be object or undefined");return Object.assign(e,t)},t.createHasher=y,t.createOptHasher=g,t.createXOFer=m,t.randomBytes=function(e=32){if(n.crypto&&"function"==typeof n.crypto.getRandomValues)return n.crypto.getRandomValues(new Uint8Array(e));if(n.crypto&&"function"==typeof n.crypto.randomBytes)return Uint8Array.from(n.crypto.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")};const n=s(9517);function r(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function o(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function i(e,...t){if(!r(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function a(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function c(e){for(let t=0;t<e.length;t++)e[t]=a(e[t]);return e}t.isLE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0],t.swap8IfBE=t.isLE?e=>e:e=>a(e),t.byteSwapIfBE=t.swap8IfBE,t.swap32IfBE=t.isLE?e=>e:c;const h=(()=>"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex)(),d=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));const u={_0:48,_9:57,A:65,F:70,a:97,f:102};function l(e){return e>=u._0&&e<=u._9?e-u._0:e>=u.A&&e<=u.F?e-(u.A-10):e>=u.a&&e<=u.f?e-(u.a-10):void 0}function f(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}function p(e){return"string"==typeof e&&(e=f(e)),i(e),e}t.nextTick=async()=>{};function y(e){const t=t=>e().update(p(t)).digest(),s=e();return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=()=>e(),t}function g(e){const t=(t,s)=>e(s).update(p(t)).digest(),s=e({});return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=t=>e(t),t}function m(e){const t=(t,s)=>e(s).update(p(t)).digest(),s=e({});return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=t=>e(t),t}t.Hash=class{},t.wrapConstructor=y,t.wrapConstructorWithOpts=g,t.wrapXOFConstructorWithOpts=m},65:(e,t,s)=>{e.exports=function(e){function t(e){let s,r,o,i=null;function a(...e){if(!a.enabled)return;const n=a,r=Number(new Date),o=r-(s||r);n.diff=o,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((s,r)=>{if("%%"===s)return"%";i++;const o=t.formatters[r];if("function"==typeof o){const t=e[i];s=o.call(n,t),e.splice(i,1),i--}return s})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function r(e,t){let s=0,n=0,r=-1,o=0;for(;s<e.length;)if(n<t.length&&(t[n]===e[s]||"*"===t[n]))"*"===t[n]?(r=n,o=s,n++):(s++,n++);else{if(-1===r)return!1;n=r+1,o++,s=o}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const s=("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const n of s)"-"===n[0]?t.skips.push(n.slice(1)):t.names.push(n)},t.enabled=function(e){for(const s of t.skips)if(r(e,s))return!1;for(const s of t.names)if(r(e,s))return!0;return!1},t.humanize=s(9049),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((s=>{t[s]=e[s]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},182:(e,t,s)=>{"use strict";s.d(t,{K2:()=>n});s(9911);var n=s(7656)},413:(e,t,s)=>{"use strict";s.d(t,{b:()=>n});var n=s(1343)},556:(e,t,s)=>{"use strict";s.d(t,{iw:()=>Rn,lc:()=>Pn,l6:()=>n});var n={};s.r(n),s.d(n,{decode:()=>Qs,encode:()=>Ys});var r=s(182),o=s(4734),i=s(413);new WeakMap;function a(){const e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s.g?s.g:void 0;if(e.__xstate__)return e.__xstate__}const c=e=>{if("undefined"==typeof window)return;const t=a();t&&t.register(e)};class h{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){const t={value:e,next:null};if(this._current)return this._last.next=t,void(this._last=t);this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){const e=this._current;this._process(e.value),this._current=e.next}this._last=null}}const d="xstate.init",u="xstate.stop";function l(e,t){return{type:`xstate.done.state.${e}`,output:t}}function f(e){return{type:d,input:e}}function p(e){setTimeout((()=>{throw e}))}const y="function"==typeof Symbol&&Symbol.observable||"@@observable";function g(e,t){const s=b(e),n=b(t);return"string"==typeof n?"string"==typeof s&&n===s:"string"==typeof s?s in n:Object.keys(s).every((e=>e in n&&g(s[e],n[e])))}function m(e){if(A(e))return e;const t=[];let s="";for(let n=0;n<e.length;n++){switch(e.charCodeAt(n)){case 92:s+=e[n+1],n++;continue;case 46:t.push(s),s="";continue}s+=e[n]}return t.push(s),t}function b(e){if((t=e)&&"object"==typeof t&&"machine"in t&&"value"in t)return e.value;var t;if("string"!=typeof e)return e;return function(e){if(1===e.length)return e[0];const t={};let s=t;for(let n=0;n<e.length-1;n++)if(n===e.length-2)s[e[n]]=e[n+1];else{const t=s;s={},t[e[n]]=s}return t}(m(e))}function w(e,t){const s={},n=Object.keys(e);for(let r=0;r<n.length;r++){const o=n[r];s[o]=t(e[o],o,e,r)}return s}function v(e){return A(e)?e:[e]}function S(e){return void 0===e?[]:v(e)}function I(e,t,s,n){return"function"==typeof e?e({context:t,event:s,self:n}):e}function A(e){return Array.isArray(e)}function _(e){return v(e).map((e=>void 0===e||"string"==typeof e?{target:e}:e))}function x(e){if(void 0!==e&&""!==e)return S(e)}function E(e,t,s){const n="object"==typeof e,r=n?e:void 0;return{next:(n?e.next:e)?.bind(r),error:(n?e.error:t)?.bind(r),complete:(n?e.complete:s)?.bind(r)}}function H(e,t){return`${t}.${e}`}function C(e,t){const s=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!s)return e.implementations.actors[t];const[,n,r]=s,o=e.getStateNodeById(r).config.invoke;return(Array.isArray(o)?o[n]:o).src}function k(e,t){return`${e.sessionId}.${t}`}let D=0;let U=!1;let M=function(e){return e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped",e}({});const O={clock:{setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e)},logger:console.log.bind(console),devTools:!1};class L{constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new h(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=M.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...O,...t},{clock:n,logger:r,parent:o,syncSnapshot:i,id:a,systemId:c,inspect:d}=s;this.system=o?o.system:function(e,t){const s=new Map,n=new Map,r=new WeakMap,o=new Set,i={},{clock:a,logger:c}=t,h={schedule:(e,t,s,n,r=Math.random().toString(36).slice(2))=>{const o={source:e,target:t,event:s,delay:n,id:r,startedAt:Date.now()},c=k(e,r);d._snapshot._scheduledEvents[c]=o;const h=a.setTimeout((()=>{delete i[c],delete d._snapshot._scheduledEvents[c],d._relay(e,t,s)}),n);i[c]=h},cancel:(e,t)=>{const s=k(e,t),n=i[s];delete i[s],delete d._snapshot._scheduledEvents[s],void 0!==n&&a.clearTimeout(n)},cancelAll:e=>{for(const t in d._snapshot._scheduledEvents){const s=d._snapshot._scheduledEvents[t];s.source===e&&h.cancel(e,s.id)}}},d={_snapshot:{_scheduledEvents:(t?.snapshot&&t.snapshot.scheduler)??{}},_bookId:()=>"x:"+D++,_register:(e,t)=>(s.set(e,t),e),_unregister:e=>{s.delete(e.sessionId);const t=r.get(e);void 0!==t&&(n.delete(t),r.delete(e))},get:e=>n.get(e),_set:(e,t)=>{const s=n.get(e);if(s&&s!==t)throw new Error(`Actor with system ID '${e}' already exists.`);n.set(e,t),r.set(t,e)},inspect:e=>{const t=E(e);return o.add(t),{unsubscribe(){o.delete(t)}}},_sendInspectionEvent:t=>{if(!o.size)return;const s={...t,rootId:e.sessionId};o.forEach((e=>e.next?.(s)))},_relay:(e,t,s)=>{d._sendInspectionEvent({type:"@xstate.event",sourceRef:e,actorRef:t,event:s}),t._send(s)},scheduler:h,getSnapshot:()=>({_scheduledEvents:{...d._snapshot._scheduledEvents}}),start:()=>{const e=d._snapshot._scheduledEvents;d._snapshot._scheduledEvents={};for(const t in e){const{source:s,target:n,event:r,delay:o,id:i}=e[t];h.schedule(s,n,r,o,i)}},_clock:a,_logger:c};return d}(this,{clock:n,logger:r}),d&&!o&&this.system.inspect(E(d)),this.sessionId=this.system._bookId(),this.id=a??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=o,this._syncSnapshot=i,this.options=s,this.src=s.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:e=>{this._deferred.push(e)},system:this.system,stopChild:e=>{if(e._parent!==this)throw new Error(`Cannot stop child actor ${e.id} of ${this.id} because it is not a child`);e._stop()},emit:e=>{const t=this.eventListeners.get(e.type),s=this.eventListeners.get("*");if(!t&&!s)return;const n=[...t?t.values():[],...s?s.values():[]];for(const r of n)r(e)},actionExecutor:e=>{const t=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:e.type,params:e.params}}),!e.exec)return;const t=U;try{U=!0,e.exec(e.info,e.params)}finally{U=t}};this._processingStatus===M.Running?t():this._deferred.push(t)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),c&&(this._systemId=c,this.system._set(c,this)),this._initState(t?.snapshot??t?.state),c&&"active"!==this._snapshot.status&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(t){this._snapshot={status:"error",output:void 0,error:t}}}update(e,t){let s;for(this._snapshot=e;s=this._deferred.shift();)try{s()}catch(o){this._deferred.length=0,this._snapshot={...e,status:"error",error:o}}switch(this._snapshot.status){case"active":for(const t of this.observers)try{t.next?.(e)}catch(o){p(o)}break;case"done":for(const t of this.observers)try{t.next?.(e)}catch(o){p(o)}this._stopProcedure(),this._complete(),this._doneEvent=(n=this.id,r=this._snapshot.output,{type:`xstate.done.actor.${n}`,output:r,actorId:n}),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error)}var n,r;this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,s){const n=E(e,t,s);if(this._processingStatus!==M.Stopped)this.observers.add(n);else switch(this._snapshot.status){case"done":try{n.complete?.()}catch(r){p(r)}break;case"error":{const e=this._snapshot.error;if(n.error)try{n.error(e)}catch(r){p(r)}else p(e);break}}return{unsubscribe:()=>{this.observers.delete(n)}}}on(e,t){let s=this.eventListeners.get(e);s||(s=new Set,this.eventListeners.set(e,s));const n=t.bind(void 0);return s.add(n),{unsubscribe:()=>{s.delete(n)}}}start(){if(this._processingStatus===M.Running)return this;this._syncSnapshot&&this.subscribe({next:e=>{"active"===e.status&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:e})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=M.Running;const e=f(this.options.input);this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e});switch(this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(t){return this._snapshot={...this._snapshot,status:"error",error:t},this._error(t),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,s;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(n){s={err:n}}if(s){const{err:e}=s;return this._snapshot={...this._snapshot,status:"error",error:e},void this._error(e)}this.update(t,e),e.type===u&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===M.Stopped?this:(this.mailbox.clear(),this._processingStatus===M.NotStarted?(this._processingStatus=M.Stopped,this):(this.mailbox.enqueue({type:u}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const t of this.observers)try{t.complete?.()}catch(e){p(e)}this.observers.clear()}_reportError(e){if(!this.observers.size)return void(this._parent||p(e));let t=!1;for(const n of this.observers){const r=n.error;t||=!r;try{r?.(e)}catch(s){p(s)}}this.observers.clear(),t&&p(e)}_error(e){var t;this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,{type:`xstate.error.actor.${t=this.id}`,error:e,actorId:t})}_stopProcedure(){return this._processingStatus!==M.Running||(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new h(this._process.bind(this)),this._processingStatus=M.Stopped,this.system._unregister(this)),this}_send(e){this._processingStatus!==M.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){const{devTools:e}=this.options;if(e){("function"==typeof e?e:c)(this)}}toJSON(){return{xstate$$type:1,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[y](){return this}getSnapshot(){return this._snapshot}}function B(e,...[t]){return new L(e,t)}function P(e,t,s,n,{sendId:r}){return[t,{sendId:"function"==typeof r?r(s,n):r},void 0]}function R(e,t){e.defer((()=>{e.system.scheduler.cancel(e.self,t.sendId)}))}function F(e,t,s,n,{id:r,systemId:o,src:i,input:a,syncSnapshot:c}){const h="string"==typeof i?C(t.machine,i):i,d="function"==typeof r?r(s):r;let u,l;return h&&(l="function"==typeof a?a({context:t.context,event:s.event,self:e.self}):a,u=B(h,{id:d,src:i,parent:e.self,syncSnapshot:c,systemId:o,input:l})),[Be(t,{children:{...t.children,[d]:u}}),{id:r,systemId:o,actorRef:u,src:i,input:l},void 0]}function $(e,{actorRef:t}){t&&e.defer((()=>{t._processingStatus!==M.Stopped&&t.start()}))}function V(...[e,{id:t,systemId:s,input:n,syncSnapshot:r=!1}={}]){function o(e,t){}return o.type="xstate.spawnChild",o.id=t,o.systemId=s,o.src=e,o.input=n,o.syncSnapshot=r,o.resolve=F,o.execute=$,o}function j(e,t,s,n,{actorRef:r}){const o="function"==typeof r?r(s,n):r,i="string"==typeof o?t.children[o]:o;let a=t.children;return i&&(a={...a},delete a[i.id]),[Be(t,{children:a}),i,void 0]}function T(e,t){t&&(e.system._unregister(t),t._processingStatus===M.Running?e.defer((()=>{e.stopChild(t)})):e.stopChild(t))}function K(e){function t(e,t){}return t.type="xstate.stopChild",t.actorRef=e,t.resolve=j,t.execute=T,t}function N(e,t,s,n){const{machine:r}=n,o="function"==typeof e,i=o?e:r.implementations.guards["string"==typeof e?e:e.type];if(!o&&!i)throw new Error(`Guard '${"string"==typeof e?e:e.type}' is not implemented.'.`);if("function"!=typeof i)return N(i,t,s,n);const a={context:t,event:s},c=o||"string"==typeof e?void 0:"params"in e?"function"==typeof e.params?e.params({context:t,event:s}):e.params:void 0;if(!("check"in i))return i(a,c);return i.check(n,a,i)}const z=e=>"atomic"===e.type||"final"===e.type;function G(e){return Object.values(e.states).filter((e=>"history"!==e.type))}function W(e,t){const s=[];if(t===e)return s;let n=e.parent;for(;n&&n!==t;)s.push(n),n=n.parent;return s}function J(e){const t=new Set(e),s=Y(t);for(const n of t)if("compound"!==n.type||s.get(n)&&s.get(n).length){if("parallel"===n.type)for(const e of G(n))if("history"!==e.type&&!t.has(e)){const s=re(e);for(const e of s)t.add(e)}}else re(n).forEach((e=>t.add(e)));for(const n of t){let e=n.parent;for(;e;)t.add(e),e=e.parent}return t}function q(e,t){const s=t.get(e);if(!s)return{};if("compound"===e.type){const e=s[0];if(!e)return{};if(z(e))return e.key}const n={};for(const r of s)n[r.key]=q(r,t);return n}function Y(e){const t=new Map;for(const s of e)t.has(s)||t.set(s,[]),s.parent&&(t.has(s.parent)||t.set(s.parent,[]),t.get(s.parent).push(s));return t}function Q(e,t){return q(e,Y(J(t)))}function Z(e,t){return"compound"===t.type?G(t).some((t=>"final"===t.type&&e.has(t))):"parallel"===t.type?G(t).every((t=>Z(e,t))):"final"===t.type}const X=e=>"#"===e[0];function ee(e){const t=e.config.after;if(!t)return[];const s=t=>{const s=(n=t,r=e.id,{type:`xstate.after.${n}.${r}`});var n,r;const o=s.type;return e.entry.push(function(e,t){function s(e,t){}return s.type="xstate.raise",s.event=e,s.id=t?.id,s.delay=t?.delay,s.resolve=Fe,s.execute=$e,s}(s,{id:o,delay:t})),e.exit.push(function(e){function t(e,t){}return t.type="xstate.cancel",t.sendId=e,t.resolve=P,t.execute=R,t}(o)),o},n=Object.keys(t).flatMap((e=>{const n=t[e],r="string"==typeof n?{target:n}:n,o=Number.isNaN(+e)?e:+e,i=s(o);return S(r).map((e=>({...e,event:i,delay:o})))}));return n.map((t=>{const{delay:s}=t;return{...te(e,t.event,t),delay:s}}))}function te(e,t,s){const n=x(s.target),r=s.reenter??!1,o=function(e,t){if(void 0===t)return;return t.map((t=>{if("string"!=typeof t)return t;if(X(t))return e.machine.getStateNodeById(t);const s="."===t[0];if(s&&!e.parent)return ae(e,t.slice(1));const n=s?e.key+t:t;if(!e.parent)throw new Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`);try{return ae(e.parent,n)}catch(r){throw new Error(`Invalid transition definition for state node '${e.id}':\n${r.message}`)}}))}(e,n),i={...s,actions:S(s.actions),guard:s.guard,target:o,source:e,reenter:r,eventType:t,toJSON:()=>({...i,source:`#${e.id}`,target:o?o.map((e=>`#${e.id}`)):void 0})};return i}function se(e){const t=x(e.config.target);return t?{target:t.map((t=>"string"==typeof t?ae(e.parent,t):t))}:e.parent.initial}function ne(e){return"history"===e.type}function re(e){const t=oe(e);for(const s of t)for(const n of W(s,e))t.add(n);return t}function oe(e){const t=new Set;return function e(s){if(!t.has(s))if(t.add(s),"compound"===s.type)e(s.initial.target[0]);else if("parallel"===s.type)for(const t of G(s))e(t)}(e),t}function ie(e,t){if(X(t))return e.machine.getStateNodeById(t);if(!e.states)throw new Error(`Unable to retrieve child state '${t}' from '${e.id}'; no child states exist.`);const s=e.states[t];if(!s)throw new Error(`Child state '${t}' does not exist on '${e.id}'`);return s}function ae(e,t){if("string"==typeof t&&X(t))try{return e.machine.getStateNodeById(t)}catch{}const s=m(t).slice();let n=e;for(;s.length;){const e=s.shift();if(!e.length)break;n=ie(n,e)}return n}function ce(e,t){if("string"==typeof t){const s=e.states[t];if(!s)throw new Error(`State '${t}' does not exist on '${e.id}'`);return[e,s]}const s=Object.keys(t),n=s.map((t=>ie(e,t))).filter(Boolean);return[e.machine.root,e].concat(n,s.reduce(((s,n)=>{const r=ie(e,n);if(!r)return s;const o=ce(r,t[n]);return s.concat(o)}),[]))}function he(e,t,s,n){return"string"==typeof t?function(e,t,s,n){const r=ie(e,t).next(s,n);return r&&r.length?r:e.next(s,n)}(e,t,s,n):1===Object.keys(t).length?function(e,t,s,n){const r=Object.keys(t),o=he(ie(e,r[0]),t[r[0]],s,n);return o&&o.length?o:e.next(s,n)}(e,t,s,n):function(e,t,s,n){const r=[];for(const o of Object.keys(t)){const i=t[o];if(!i)continue;const a=he(ie(e,o),i,s,n);a&&r.push(...a)}return r.length?r:e.next(s,n)}(e,t,s,n)}function de(e){return Object.keys(e.states).map((t=>e.states[t])).filter((e=>"history"===e.type))}function ue(e,t){let s=e;for(;s.parent&&s.parent!==t;)s=s.parent;return s.parent===t}function le(e,t){const s=new Set(e),n=new Set(t);for(const r of s)if(n.has(r))return!0;for(const r of n)if(s.has(r))return!0;return!1}function fe(e,t,s){const n=new Set;for(const r of e){let e=!1;const o=new Set;for(const i of n)if(le(ge([r],t,s),ge([i],t,s))){if(!ue(r.source,i.source)){e=!0;break}o.add(i)}if(!e){for(const e of o)n.delete(e);n.add(r)}}return Array.from(n)}function pe(e,t){if(!e.target)return[];const s=new Set;for(const n of e.target)if(ne(n))if(t[n.id])for(const e of t[n.id])s.add(e);else for(const e of pe(se(n),t))s.add(e);else s.add(n);return[...s]}function ye(e,t){const s=pe(e,t);if(!s)return;if(!e.reenter&&s.every((t=>t===e.source||ue(t,e.source))))return e.source;const n=function(e){const[t,...s]=e;for(const n of W(t,void 0))if(s.every((e=>ue(e,n))))return n}(s.concat(e.source));return n||(e.reenter?void 0:e.source.machine.root)}function ge(e,t,s){const n=new Set;for(const r of e)if(r.target?.length){const e=ye(r,s);r.reenter&&r.source===e&&n.add(e);for(const s of t)ue(s,e)&&n.add(s)}return[...n]}function me(e,t,s,n,r,o){if(!e.length)return t;const i=new Set(t._nodes);let a=t.historyValue;const c=fe(e,i,a);let h=t;r||([h,a]=function(e,t,s,n,r,o,i){let a=e;const c=ge(n,r,o);let h;c.sort(((e,t)=>t.order-e.order));for(const d of c)for(const e of de(d)){let t;t="deep"===e.history?e=>z(e)&&ue(e,d):e=>e.parent===d,h??={...o},h[e.id]=Array.from(r).filter(t)}for(const d of c)a=_e(a,t,s,[...d.exit,...d.invoke.map((e=>K(e.id)))],i,void 0),r.delete(d);return[a,h||o]}(h,n,s,c,i,a,o,s.actionExecutor)),h=_e(h,n,s,c.flatMap((e=>e.actions)),o,void 0),h=function(e,t,s,n,r,o,i,a){let c=e;const h=new Set,d=new Set;(function(e,t,s,n){for(const r of e){const e=ye(r,t);for(const i of r.target||[])ne(i)||r.source===i&&r.source===e&&!r.reenter||(n.add(i),s.add(i)),we(i,t,s,n);const o=pe(r,t);for(const i of o){const o=W(i,e);"parallel"===e?.type&&o.push(e),ve(n,t,s,o,!r.source.parent&&r.reenter?void 0:e)}}})(n,i,d,h),a&&d.add(e.machine.root);const u=new Set;for(const f of[...h].sort(((e,t)=>e.order-t.order))){r.add(f);const e=[];e.push(...f.entry);for(const t of f.invoke)e.push(V(t.src,{...t,syncSnapshot:!!t.onSnapshot}));if(d.has(f)){const t=f.initial.actions;e.push(...t)}if(c=_e(c,t,s,e,o,f.invoke.map((e=>e.id))),"final"===f.type){const e=f.parent;let n="parallel"===e?.type?e:e?.parent,i=n||f;for("compound"===e?.type&&o.push(l(e.id,void 0!==f.output?I(f.output,c.context,t,s.self):void 0));"parallel"===n?.type&&!u.has(n)&&Z(r,n);)u.add(n),o.push(l(n.id)),i=n,n=n.parent;if(n)continue;c=Be(c,{status:"done",output:be(c,t,s,c.machine.root,i)})}}return c}(h,n,s,c,i,o,a,r);const d=[...i];"done"===h.status&&(h=_e(h,n,s,d.sort(((e,t)=>t.order-e.order)).flatMap((e=>e.exit)),o,void 0));try{return a===t.historyValue&&function(e,t){if(e.length!==t.size)return!1;for(const s of e)if(!t.has(s))return!1;return!0}(t._nodes,i)?h:Be(h,{_nodes:d,historyValue:a})}catch(u){throw u}}function be(e,t,s,n,r){if(void 0===n.output)return;const o=l(r.id,void 0!==r.output&&r.parent?I(r.output,e.context,t,s.self):void 0);return I(n.output,e.context,o,s.self)}function we(e,t,s,n){if(ne(e))if(t[e.id]){const r=t[e.id];for(const e of r)n.add(e),we(e,t,s,n);for(const o of r)Se(o,e.parent,n,t,s)}else{const r=se(e);for(const o of r.target)n.add(o),r===e.parent?.initial&&s.add(e.parent),we(o,t,s,n);for(const o of r.target)Se(o,e.parent,n,t,s)}else if("compound"===e.type){const[r]=e.initial.target;ne(r)||(n.add(r),s.add(r)),we(r,t,s,n),Se(r,e,n,t,s)}else if("parallel"===e.type)for(const r of G(e).filter((e=>!ne(e))))[...n].some((e=>ue(e,r)))||(ne(r)||(n.add(r),s.add(r)),we(r,t,s,n))}function ve(e,t,s,n,r){for(const o of n)if(r&&!ue(o,r)||e.add(o),"parallel"===o.type)for(const n of G(o).filter((e=>!ne(e))))[...e].some((e=>ue(e,n)))||(e.add(n),we(n,t,s,e))}function Se(e,t,s,n,r){ve(s,n,r,W(e,t))}function Ie(e,t){return e.implementations.actions[t]}function Ae(e,t,s,n,r,o){const{machine:i}=e;let a=e;for(const c of n){const e="function"==typeof c,n=e?c:Ie(i,"string"==typeof c?c:c.type),h={context:a.context,event:t,self:s.self,system:s.system},d=e||"string"==typeof c?void 0:"params"in c?"function"==typeof c.params?c.params({context:a.context,event:t}):c.params:void 0;if(!n||!("resolve"in n)){s.actionExecutor({type:"string"==typeof c?c:"object"==typeof c?c.type:c.name||"(anonymous)",info:h,params:d,exec:n});continue}const u=n,[l,f,p]=u.resolve(s,a,h,d,n,r);a=l,"retryResolve"in u&&o?.push([u,f]),"execute"in u&&s.actionExecutor({type:u.type,info:h,params:f,exec:u.execute.bind(null,s,f)}),p&&(a=Ae(a,t,s,p,r,o))}return a}function _e(e,t,s,n,r,o){const i=o?[]:void 0,a=Ae(e,t,s,n,{internalQueue:r,deferredActorIds:o},i);return i?.forEach((([e,t])=>{e.retryResolve(s,a,t)})),a}function xe(e,t,s,n){let r=e;const o=[];function i(e,t,n){s.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:s.self,event:t,snapshot:e,_transitions:n}),o.push(e)}if(t.type===u)return r=Be(Ee(r,t,s),{status:"stopped"}),i(r,t,[]),{snapshot:r,microstates:o};let a=t;if(a.type!==d){const t=a,c=function(e){return e.type.startsWith("xstate.error.actor")}(t),h=He(t,r);if(c&&!h.length)return r=Be(e,{status:"error",error:t.error}),i(r,t,[]),{snapshot:r,microstates:o};r=me(h,e,s,a,!1,n),i(r,t,h)}let c=!0;for(;"active"===r.status;){let e=c?Ce(r,a):[];const t=e.length?r:void 0;if(!e.length){if(!n.length)break;a=n.shift(),e=He(a,r)}r=me(e,r,s,a,!1,n),c=r!==t,i(r,a,e)}return"active"!==r.status&&Ee(r,a,s),{snapshot:r,microstates:o}}function Ee(e,t,s){return _e(e,t,s,Object.values(e.children).map((e=>K(e))),[],void 0)}function He(e,t){return t.machine.getTransitionData(t,e)}function Ce(e,t){const s=new Set,n=e._nodes.filter(z);for(const r of n)e:for(const n of[r].concat(W(r,void 0)))if(n.always)for(const r of n.always)if(void 0===r.guard||N(r.guard,e.context,t,e)){s.add(r);break e}return fe(Array.from(s),new Set(e._nodes),e.historyValue)}const ke=function(e){return g(e,this.value)},De=function(e){return this.tags.has(e)},Ue=function(e){const t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some((e=>void 0!==e.target||e.actions.length))},Me=function(){const{_nodes:e,tags:t,machine:s,getMeta:n,toJSON:r,can:o,hasTag:i,matches:a,...c}=this;return{...c,tags:Array.from(t)}},Oe=function(){return this._nodes.reduce(((e,t)=>(void 0!==t.meta&&(e[t.id]=t.meta),e)),{})};function Le(e,t){return{status:e.status,output:e.output,error:e.error,machine:t,context:e.context,_nodes:e._nodes,value:Q(t.root,e._nodes),tags:new Set(e._nodes.flatMap((e=>e.tags))),children:e.children,historyValue:e.historyValue||{},matches:ke,hasTag:De,can:Ue,getMeta:Oe,toJSON:Me}}function Be(e,t={}){return Le({...e,...t},e.machine)}function Pe(e){if("object"!=typeof e||null===e)return{};const t={};for(const s in e){const n=e[s];Array.isArray(n)&&(t[s]=n.map((e=>({id:e.id}))))}return t}function Re(e){let t;for(const s in e){const n=e[s];if(n&&"object"==typeof n)if("sessionId"in n&&"send"in n&&"ref"in n)t??=Array.isArray(e)?e.slice():{...e},t[s]={xstate$$type:1,id:n.id};else{const r=Re(n);r!==n&&(t??=Array.isArray(e)?e.slice():{...e},t[s]=r)}}return t??e}function Fe(e,t,s,n,{event:r,id:o,delay:i},{internalQueue:a}){const c=t.machine.implementations.delays;if("string"==typeof r)throw new Error(`Only event objects may be used with raise; use raise({ type: "${r}" }) instead`);const h="function"==typeof r?r(s,n):r;let d;if("string"==typeof i){const e=c&&c[i];d="function"==typeof e?e(s,n):e}else d="function"==typeof i?i(s,n):i;return"number"!=typeof d&&a.push(h),[t,{event:h,id:o,delay:d},void 0]}function $e(e,t){const{event:s,delay:n,id:r}=t;"number"!=typeof n||e.defer((()=>{const t=e.self;e.system.scheduler.schedule(t,t,s,n,r)}))}function Ve(e,{machine:t,context:s},n,r){return(o,i)=>{const a=((o,i)=>{if("string"==typeof o){const a=C(t,o);if(!a)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const c=B(a,{id:i?.id,parent:e.self,syncSnapshot:i?.syncSnapshot,input:"function"==typeof i?.input?i.input({context:s,event:n,self:e.self}):i?.input,src:o,systemId:i?.systemId});return r[c.id]=c,c}return B(o,{id:i?.id,parent:e.self,syncSnapshot:i?.syncSnapshot,input:i?.input,src:o,systemId:i?.systemId})})(o,i);return r[a.id]=a,e.defer((()=>{a._processingStatus!==M.Stopped&&a.start()})),a}}function je(e,t,s,n,{assignment:r}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const o={},i={context:t.context,event:s.event,spawn:Ve(e,t,s.event,o),self:e.self,system:e.system};let a={};if("function"==typeof r)a=r(i,n);else for(const c of Object.keys(r)){const e=r[c];a[c]="function"==typeof e?e(i,n):e}return[Be(t,{context:Object.assign({},t.context,a),children:Object.keys(o).length?{...t.children,...o}:t.children}),void 0,void 0]}function Te(e){function t(e,t){}return t.type="xstate.assign",t.assignment=e,t.resolve=je,t}const Ke=new WeakMap;function Ne(e,t,s){let n=Ke.get(e);return n?t in n||(n[t]=s()):(n={[t]:s()},Ke.set(e,n)),n[t]}const ze={},Ge=e=>"string"==typeof e?{type:e}:"function"==typeof e?"resolve"in e?{type:e.type}:{type:e.name}:e;class We{constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join("."),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?w(this.config.states,((e,t)=>new We(e,{_parent:this,_key:t,_machine:this.machine}))):ze,"compound"===this.type&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=!0===this.config.history?"shallow":this.config.history||!1,this.entry=S(this.config.entry).slice(),this.exit=S(this.config.exit).slice(),this.meta=this.config.meta,this.output="final"!==this.type&&this.parent?void 0:this.config.output,this.tags=S(e.tags).slice()}_initialize(){this.transitions=function(e){const t=new Map;if(e.config.on)for(const s of Object.keys(e.config.on)){if(""===s)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const n=e.config.on[s];t.set(s,_(n).map((t=>te(e,s,t))))}if(e.config.onDone){const s=`xstate.done.state.${e.id}`;t.set(s,_(e.config.onDone).map((t=>te(e,s,t))))}for(const s of e.invoke){if(s.onDone){const n=`xstate.done.actor.${s.id}`;t.set(n,_(s.onDone).map((t=>te(e,n,t))))}if(s.onError){const n=`xstate.error.actor.${s.id}`;t.set(n,_(s.onError).map((t=>te(e,n,t))))}if(s.onSnapshot){const n=`xstate.snapshot.${s.id}`;t.set(n,_(s.onSnapshot).map((t=>te(e,n,t))))}}for(const s of e.after){let e=t.get(s.eventType);e||(e=[],t.set(s.eventType,e)),e.push(s)}return t}(this),this.config.always&&(this.always=_(this.config.always).map((e=>te(this,"",e)))),Object.keys(this.states).forEach((e=>{this.states[e]._initialize()}))}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(Ge),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map((e=>`#${e.id}`)),source:`#${this.id}`,actions:this.initial.actions.map(Ge),eventType:null})}:void 0,history:this.history,states:w(this.states,(e=>e.definition)),on:this.on,transitions:[...this.transitions.values()].flat().map((e=>({...e,actions:e.actions.map(Ge)}))),entry:this.entry.map(Ge),exit:this.exit.map(Ge),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Ne(this,"invoke",(()=>S(this.config.invoke).map(((e,t)=>{const{src:s,systemId:n}=e,r=e.id??H(this.id,t),o="string"==typeof s?s:`xstate.invoke.${H(this.id,t)}`;return{...e,src:o,id:r,systemId:n,toJSON(){const{onDone:t,onError:s,...n}=e;return{...n,type:"xstate.invoke",src:o,id:r}}}}))))}get on(){return Ne(this,"on",(()=>[...this.transitions].flatMap((([e,t])=>t.map((t=>[e,t])))).reduce(((e,[t,s])=>(e[t]=e[t]||[],e[t].push(s),e)),{})))}get after(){return Ne(this,"delayedTransitions",(()=>ee(this)))}get initial(){return Ne(this,"initial",(()=>function(e,t){const s="string"==typeof t?e.states[t]:t?e.states[t.target]:void 0;if(!s&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${e.id}`);const n={source:e,actions:t&&"string"!=typeof t?S(t.actions):[],eventType:null,reenter:!1,target:s?[s]:[],toJSON:()=>({...n,source:`#${e.id}`,target:s?[`#${s.id}`]:[]})};return n}(this,this.config.initial)))}next(e,t){const s=t.type,n=[];let r;const o=Ne(this,`candidates-${s}`,(()=>{return t=s,(e=this).transitions.get(t)||[...e.transitions.keys()].filter((e=>{if("*"===e)return!0;if(!e.endsWith(".*"))return!1;const s=e.split("."),n=t.split(".");for(let t=0;t<s.length;t++){const e=s[t],r=n[t];if("*"===e)return t===s.length-1;if(e!==r)return!1}return!0})).sort(((e,t)=>t.length-e.length)).flatMap((t=>e.transitions.get(t)));var e,t}));for(const a of o){const{guard:o}=a,c=e.context;let h=!1;try{h=!o||N(o,c,t,e)}catch(i){const e="string"==typeof o?o:"object"==typeof o?o.type:void 0;throw new Error(`Unable to evaluate guard ${e?`'${e}' `:""}in transition for event '${s}' in state node '${this.id}':\n${i.message}`)}if(h){n.push(...a.actions),r=a;break}}return r?[r]:void 0}get events(){return Ne(this,"events",(()=>{const{states:e}=this,t=new Set(this.ownEvents);if(e)for(const s of Object.keys(e)){const n=e[s];if(n.states)for(const e of n.events)t.add(`${e}`)}return Array.from(t)}))}get ownEvents(){const e=new Set([...this.transitions.keys()].filter((e=>this.transitions.get(e).some((e=>!(!e.target&&!e.actions.length&&!e.reenter))))));return Array.from(e)}}class Je{constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new We(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){const{actions:t,guards:s,actors:n,delays:r}=this.implementations;return new Je(this.config,{actions:{...t,...e.actions},guards:{...s,...e.guards},actors:{...n,...e.actors},delays:{...r,...e.delays}})}resolveState(e){const t=(s=this.root,n=e.value,Q(s,[...J(ce(s,n))]));var s,n;const r=J(ce(this.root,t));return Le({_nodes:[...r],context:e.context||{},children:{},status:Z(r,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,s){return xe(e,t,s,[]).snapshot}microstep(e,t,s){return xe(e,t,s,[]).microstates}getTransitionData(e,t){return he(this.root,e.value,e,t)||[]}getPreInitialState(e,t,s){const{context:n}=this.config,r=Le({context:"function"!=typeof n&&n?n:{},_nodes:[this.root],children:{},status:"active"},this);if("function"==typeof n){return _e(r,t,e,[Te((({spawn:e,event:t,self:s})=>n({spawn:e,input:t.input,self:s})))],s,void 0)}return r}getInitialSnapshot(e,t){const s=f(t),n=[],r=this.getPreInitialState(e,s,n),o=me([{target:[...oe(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,e,s,!0,n),{snapshot:i}=xe(o,s,e,n);return i}start(e){Object.values(e.children).forEach((e=>{"active"===e.getSnapshot().status&&e.start()}))}getStateNodeById(e){const t=m(e),s=t.slice(1),n=X(t[0])?t[0].slice(1):t[0],r=this.idMap.get(n);if(!r)throw new Error(`Child state node '#${n}' does not exist on machine '${this.id}'`);return ae(r,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return function(e,t){const{_nodes:s,tags:n,machine:r,children:o,context:i,can:a,hasTag:c,matches:h,getMeta:d,toJSON:u,...l}=e,f={};for(const p in o){const e=o[p];f[p]={snapshot:e.getPersistedSnapshot(t),src:e.src,systemId:e._systemId,syncSnapshot:e._syncSnapshot}}return{...l,context:Re(i),children:f,historyValue:Pe(l.historyValue)}}(e,t)}restoreSnapshot(e,t){const s={},n=e.children;function r(e,t){try{return t.machine.getStateNodeById(e)}catch{try{return ae(t,e.split("."))}catch{return e}}}Object.keys(n).forEach((e=>{const r=n[e],o=r.snapshot,i=r.src,a="string"==typeof i?C(this,i):i;if(!a)return;const c=B(a,{id:e,parent:t.self,syncSnapshot:r.syncSnapshot,snapshot:o,src:i,systemId:r.systemId});s[e]=c}));const o=function(e,t){if(!e||"object"!=typeof e)return{};const s={};for(const n in e){const o=e[n];s[n]=o.map((e=>{if(e instanceof We)return e;if("object"==typeof e&&"id"in e&&"string"==typeof e.id){const s=r(e.id,t);if(s instanceof We)return s}})).filter((e=>void 0!==e)),0===s[n].length&&delete s[n]}return s}(e.historyValue,this.root),i=Le({...e,children:s,_nodes:Array.from(J(ce(this.root,e.value))),historyValue:o},this),a=new Set;return function e(t,s){if(!a.has(t)){a.add(t);for(const n in t){const r=t[n];if(r&&"object"==typeof r){if("xstate$$type"in r&&1===r.xstate$$type){t[n]=s[r.id];continue}e(r,s)}}}}(i.context,s),i}}function qe({schemas:e,actors:t,actions:s,guards:n,delays:r}){return{createMachine:o=>function(e,t){return new Je(e,t)}({...o,schemas:e},{actors:t,actions:s,guards:n,delays:r})}}const Ye={timeout:1/0};var Qe=s(5622),Ze=s(6977),Xe=s(8039),et=s(4008),tt=s(9383);const st=e=>Array.from(e,(e=>e.toString(16).padStart(2,"0"))).join(""),nt="automerge:",rt=e=>{const[t,s,...n]=e.split("#");if(n.length>0)throw new Error("Invalid URL: contains multiple heads sections");const r=new RegExp(`^${nt}(\\w+)$`),[,o]=t.match(r)||[],i=o,a=ht(i);if(!a)throw new Error("Invalid document URL: "+e);if(void 0===s)return{binaryDocumentId:a,documentId:i};const c=""===s?[]:s.split("|");return{binaryDocumentId:a,hexHeads:c.map((e=>{try{return st(tt.decode(e))}catch(t){throw new Error(`Invalid head in URL: ${e}`)}})),documentId:i,heads:c}},ot=e=>{if(e instanceof Uint8Array||"string"==typeof e)return nt+(e instanceof Uint8Array?dt(e):e);const{documentId:t,heads:s}=e;if(void 0===t)throw new Error("Invalid documentId: "+t);const n=t instanceof Uint8Array?dt(t):t;let r=`${nt}${n}`;return void 0!==s&&(s.forEach((e=>{try{tt.decode(e)}catch(t){throw new Error(`Invalid head: ${e}`)}})),r+="#"+s.join("|")),r},it=e=>{if("string"!=typeof e||!e||!e.startsWith(nt))return!1;try{const{documentId:t,heads:s}=rt(e);return!!at(t)&&!(s&&!s.every((e=>{try{return tt.decode(e),!0}catch{return!1}})))}catch{return!1}},at=e=>{if("string"!=typeof e)return!1;const t=ht(e);if(void 0===t)return!1;const s=Qe.A(t);return Ze.A(s)},ct=e=>"string"==typeof e&&Ze.A(e),ht=e=>tt.decodeUnsafe(e),dt=e=>tt.encode(e),ut=e=>e.map((e=>tt.encode((e=>{if(e.length%2!=0)throw new Error("Hex string must have an even length");const t=new Uint8Array(e.length/2);for(let s=0;s<e.length;s+=2)t[s>>1]=parseInt(e.slice(s,s+2),16);return t})(e)))),lt=e=>e.map((e=>st(tt.decode(e)))),ft=e=>{if(e instanceof Uint8Array)return dt(e);if(it(e))return rt(e).documentId;if(at(e))return e;if(ct(e)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const t=et.A(e);return dt(t)}throw new Error(`Invalid AutomergeUrl: '${e}'`)};let pt,yt,gt;try{pt=new TextDecoder}catch(Fn){}let mt=0;const bt=[],wt={};let vt,St,It,At,_t,xt,Et,Ht=11281e4,Ct=1681e4,kt=bt,Dt=0,Ut={},Mt=0,Ot=0,Lt=[],Bt=[],Pt={useRecords:!1,mapsAsObjects:!0},Rt=!1,Ft=2;try{new Function("")}catch(Fn){Ft=1/0}class $t{constructor(e){if(e&&(!e.keyMap&&!e._keyMap||e.useRecords||(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,s]of Object.entries(e.keyMap))this.mapKey.set(s,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[s,n]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(s)?this._keyMap[s]:s,n);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey){this._mapKey=new Map;for(let[e,t]of Object.entries(this._keyMap))this._mapKey.set(t,e)}let t={};return e.forEach(((e,s)=>t[Nt(this._mapKey.has(s)?this._mapKey.get(s):s)]=e)),t}mapDecode(e,t){let s=this.decode(e);return this._keyMap&&"Array"===s.constructor.name?s.map((e=>this.decodeKeys(e))):s}decode(e,t){if(yt)return ds((()=>(us(),this?this.decode(e,t):$t.prototype.decode.call(Pt,e,t))));gt=t>-1?t:e.length,mt=0,Dt=0,Ot=0,St=null,kt=bt,It=null,yt=e;try{xt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(Fn){if(yt=null,e instanceof Uint8Array)throw Fn;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof $t){if(Ut=this,_t=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return vt=this.structures,Vt();(!vt||vt.length>0)&&(vt=[])}else Ut=Pt,(!vt||vt.length>0)&&(vt=[]),_t=null;return Vt()}decodeMultiple(e,t){let s,n=0;try{let r=e.length;Rt=!0;let o=this?this.decode(e,r):fs.decode(e,r);if(!t){for(s=[o];mt<r;)n=mt,s.push(Vt());return s}if(!1===t(o))return;for(;mt<r;)if(n=mt,!1===t(Vt()))return}catch(Fn){throw Fn.lastPosition=n,Fn.values=s,Fn}finally{Rt=!1,us()}}}function Vt(){try{let e=jt();if(It){if(mt>=It.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}mt=It.postBundlePosition,It=null}if(mt==gt)vt=null,yt=null,At&&(At=null);else{if(mt>gt){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}if(!Rt)throw new Error("Data read, but end of buffer not reached")}return e}catch(Fn){throw us(),(Fn instanceof RangeError||Fn.message.startsWith("Unexpected end of buffer"))&&(Fn.incomplete=!0),Fn}}function jt(){let e=yt[mt++],t=e>>5;if(e&=31,e>23)switch(e){case 24:e=yt[mt++];break;case 25:if(7==t)return function(){let e=yt[mt++],t=yt[mt++],s=(127&e)>>2;if(31===s)return t||3&e?NaN:128&e?-1/0:1/0;if(0===s){let s=((3&e)<<8|t)/(1<<24);return 128&e?-s:s}return Qt[3]=128&e|56+(s>>1),Qt[2]=(7&e)<<5|t>>3,Qt[1]=t<<5,Qt[0]=0,Yt[0]}();e=xt.getUint16(mt),mt+=2;break;case 26:if(7==t){let e=xt.getFloat32(mt);if(Ut.useFloat32>2){let t=ls[(127&yt[mt])<<1|yt[mt+1]>>7];return mt+=4,(t*e+(e>0?.5:-.5)|0)/t}return mt+=4,e}e=xt.getUint32(mt),mt+=4;break;case 27:if(7==t){let e=xt.getFloat64(mt);return mt+=8,e}if(t>1){if(xt.getUint32(mt)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=xt.getUint32(mt+4)}else Ut.int64AsNumber?(e=4294967296*xt.getUint32(mt),e+=xt.getUint32(mt+4)):e=xt.getBigUint64(mt);mt+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e,s=[],n=0;for(;(e=jt())!=wt;){if(n>=Ht)throw new Error(`Array length exceeds ${Ht}`);s[n++]=e}return 4==t?s:3==t?s.join(""):Buffer.concat(s);case 5:let r;if(Ut.mapsAsObjects){let e={},t=0;if(Ut.keyMap)for(;(r=jt())!=wt;){if(t++>=Ct)throw new Error(`Property count exceeds ${Ct}`);e[Nt(Ut.decodeKey(r))]=jt()}else for(;(r=jt())!=wt;){if(t++>=Ct)throw new Error(`Property count exceeds ${Ct}`);e[Nt(r)]=jt()}return e}{Et&&(Ut.mapsAsObjects=!0,Et=!1);let e=new Map;if(Ut.keyMap){let t=0;for(;(r=jt())!=wt;){if(t++>=Ct)throw new Error(`Map size exceeds ${Ct}`);e.set(Ut.decodeKey(r),jt())}}else{let t=0;for(;(r=jt())!=wt;){if(t++>=Ct)throw new Error(`Map size exceeds ${Ct}`);e.set(r,jt())}}return e}case 7:return wt;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return s=e,Ut.copyBuffers?Uint8Array.prototype.slice.call(yt,mt,mt+=s):yt.subarray(mt,mt+=s);case 3:if(Ot>=mt)return St.slice(mt-Mt,(mt+=e)-Mt);if(0==Ot&&gt<140&&e<32){let t=e<16?qt(e):Jt(e);if(null!=t)return t}return zt(e);case 4:if(e>=Ht)throw new Error(`Array length exceeds ${Ht}`);let t=new Array(e);for(let s=0;s<e;s++)t[s]=jt();return t;case 5:if(e>=Ct)throw new Error(`Map size exceeds ${Ht}`);if(Ut.mapsAsObjects){let t={};if(Ut.keyMap)for(let s=0;s<e;s++)t[Nt(Ut.decodeKey(jt()))]=jt();else for(let s=0;s<e;s++)t[Nt(jt())]=jt();return t}{Et&&(Ut.mapsAsObjects=!0,Et=!1);let t=new Map;if(Ut.keyMap)for(let s=0;s<e;s++)t.set(Ut.decodeKey(jt()),jt());else for(let s=0;s<e;s++)t.set(jt(),jt());return t}case 6:if(e>=57337){let t=vt[8191&e];if(t)return t.read||(t.read=Kt(t)),t.read();if(e<65536){if(57343==e){let e=cs(),t=jt(),s=jt();Xt(t,s);let n={};if(Ut.keyMap)for(let r=2;r<e;r++){n[Nt(Ut.decodeKey(s[r-2]))]=jt()}else for(let r=2;r<e;r++){n[Nt(s[r-2])]=jt()}return n}if(57342==e){let e=cs(),t=jt();for(let s=2;s<e;s++)Xt(t++,jt());return jt()}if(57337==e)return function(){let e=cs(),t=mt+jt();for(let n=2;n<e;n++){let e=cs();mt+=e}let s=mt;return mt=t,It=[Gt(cs()),Gt(cs())],It.position0=0,It.position1=0,It.postBundlePosition=mt,mt=s,jt()}();if(Ut.getShared&&(hs(),t=vt[8191&e],t))return t.read||(t.read=Kt(t)),t.read()}}let n=Lt[e];if(n)return n.handlesRead?n(jt):n(jt());{let t=jt();for(let s=0;s<Bt.length;s++){let n=Bt[s](e,t);if(void 0!==n)return n}return new Zt(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let t=(_t||ns())[e];if(void 0!==t)return t;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw new Error("Unknown CBOR token "+e)}var s}const Tt=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Kt(e){if(!e)throw new Error("Structure is required in record definition");return e.slowReads=0,function(){let e=yt[mt++];if(e&=31,e>23)switch(e){case 24:e=yt[mt++];break;case 25:e=xt.getUint16(mt),mt+=2;break;case 26:e=xt.getUint32(mt),mt+=4;break;default:throw new Error("Expected array header, but got "+yt[mt-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(jt);t=t.next}if(this.slowReads++>=Ft){let s=this.length==e?this:this.slice(0,e);return t=Ut.keyMap?new Function("r","return {"+s.map((e=>Ut.decodeKey(e))).map((e=>Tt.test(e)?Nt(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"):new Function("r","return {"+s.map((e=>Tt.test(e)?Nt(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(jt)}let s={};if(Ut.keyMap)for(let n=0;n<e;n++)s[Nt(Ut.decodeKey(this[n]))]=jt();else for(let n=0;n<e;n++)s[Nt(this[n])]=jt();return s}}function Nt(e){if("string"==typeof e)return"__proto__"===e?"__proto_":e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";throw new Error("Invalid property name type "+typeof e)}let zt=Gt;function Gt(e){let t;if(e<16&&(t=qt(e)))return t;if(e>64&&pt)return pt.decode(yt.subarray(mt,mt+=e));const s=mt+e,n=[];for(t="";mt<s;){const e=yt[mt++];if(128&e)if(192==(224&e)){const t=63&yt[mt++];n.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&yt[mt++],s=63&yt[mt++];n.push((31&e)<<12|t<<6|s)}else if(240==(248&e)){let t=(7&e)<<18|(63&yt[mt++])<<12|(63&yt[mt++])<<6|63&yt[mt++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(e);else n.push(e);n.length>=4096&&(t+=Wt.apply(String,n),n.length=0)}return n.length>0&&(t+=Wt.apply(String,n)),t}let Wt=String.fromCharCode;function Jt(e){let t=mt,s=new Array(e);for(let n=0;n<e;n++){const e=yt[mt++];if((128&e)>0)return void(mt=t);s[n]=e}return Wt.apply(String,s)}function qt(e){if(e<4){if(e<2){if(0===e)return"";{let e=yt[mt++];return(128&e)>1?void(mt-=1):Wt(e)}}{let t=yt[mt++],s=yt[mt++];if((128&t)>0||(128&s)>0)return void(mt-=2);if(e<3)return Wt(t,s);let n=yt[mt++];return(128&n)>0?void(mt-=3):Wt(t,s,n)}}{let t=yt[mt++],s=yt[mt++],n=yt[mt++],r=yt[mt++];if((128&t)>0||(128&s)>0||(128&n)>0||(128&r)>0)return void(mt-=4);if(e<6){if(4===e)return Wt(t,s,n,r);{let e=yt[mt++];return(128&e)>0?void(mt-=5):Wt(t,s,n,r,e)}}if(e<8){let o=yt[mt++],i=yt[mt++];if((128&o)>0||(128&i)>0)return void(mt-=6);if(e<7)return Wt(t,s,n,r,o,i);let a=yt[mt++];return(128&a)>0?void(mt-=7):Wt(t,s,n,r,o,i,a)}{let o=yt[mt++],i=yt[mt++],a=yt[mt++],c=yt[mt++];if((128&o)>0||(128&i)>0||(128&a)>0||(128&c)>0)return void(mt-=8);if(e<10){if(8===e)return Wt(t,s,n,r,o,i,a,c);{let e=yt[mt++];return(128&e)>0?void(mt-=9):Wt(t,s,n,r,o,i,a,c,e)}}if(e<12){let h=yt[mt++],d=yt[mt++];if((128&h)>0||(128&d)>0)return void(mt-=10);if(e<11)return Wt(t,s,n,r,o,i,a,c,h,d);let u=yt[mt++];return(128&u)>0?void(mt-=11):Wt(t,s,n,r,o,i,a,c,h,d,u)}{let h=yt[mt++],d=yt[mt++],u=yt[mt++],l=yt[mt++];if((128&h)>0||(128&d)>0||(128&u)>0||(128&l)>0)return void(mt-=12);if(e<14){if(12===e)return Wt(t,s,n,r,o,i,a,c,h,d,u,l);{let e=yt[mt++];return(128&e)>0?void(mt-=13):Wt(t,s,n,r,o,i,a,c,h,d,u,l,e)}}{let f=yt[mt++],p=yt[mt++];if((128&f)>0||(128&p)>0)return void(mt-=14);if(e<15)return Wt(t,s,n,r,o,i,a,c,h,d,u,l,f,p);let y=yt[mt++];return(128&y)>0?void(mt-=15):Wt(t,s,n,r,o,i,a,c,h,d,u,l,f,p,y)}}}}}let Yt=new Float32Array(1),Qt=new Uint8Array(Yt.buffer,0,4);new Array(4096);class Zt{constructor(e,t){this.value=e,this.tag=t}}Lt[0]=e=>new Date(e),Lt[1]=e=>new Date(Math.round(1e3*e)),Lt[2]=e=>{let t=BigInt(0);for(let s=0,n=e.byteLength;s<n;s++)t=BigInt(e[s])+(t<<BigInt(8));return t},Lt[3]=e=>BigInt(-1)-Lt[2](e),Lt[4]=e=>+(e[1]+"e"+e[0]),Lt[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const Xt=(e,t)=>{let s=vt[e-=57344];s&&s.isShared&&((vt.restoreStructures||(vt.restoreStructures=[]))[e]=s),vt[e]=t,t.read=Kt(t)};Lt[105]=e=>{let t=e.length,s=e[1];Xt(e[0],s);let n={};for(let r=2;r<t;r++){n[Nt(s[r-2])]=e[r]}return n},Lt[14]=e=>It?It[0].slice(It.position0,It.position0+=e):new Zt(e,14),Lt[15]=e=>It?It[1].slice(It.position1,It.position1+=e):new Zt(e,15);let es={Error:Error,RegExp:RegExp};Lt[27]=e=>(es[e[0]]||Error)(e[1],e[2]);const ts=e=>{if(132!=yt[mt++]){let e=new Error("Packed values structure must be followed by a 4 element array");throw yt.length<mt&&(e.incomplete=!0),e}let t=e();if(!t||!t.length){let e=new Error("Packed values structure must be followed by a 4 element array");throw e.incomplete=!0,e}return _t=_t?t.concat(_t.slice(t.length)):t,_t.prefixes=e(),_t.suffixes=e(),e()};function ss(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function ns(){if(!_t){if(!Ut.getShared)throw new Error("No packed values available");hs()}return _t}ts.handlesRead=!0,Lt[51]=ts,Lt[6]=e=>{if(!_t){if(!Ut.getShared)return new Zt(e,6);hs()}if("number"==typeof e)return _t[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw void 0===e&&(t.incomplete=!0),t},Lt[28]=e=>{At||(At=new Map,At.id=0);let t,s=At.id++,n=mt;t=yt[mt]>>5==4?[]:{};let r={target:t};At.set(s,r);let o=e();return r.used?(Object.getPrototypeOf(t)!==Object.getPrototypeOf(o)&&(mt=n,t=o,At.set(s,{target:t}),o=e()),Object.assign(t,o)):(r.target=o,o)},Lt[28].handlesRead=!0,Lt[29]=e=>{let t=At.get(e);return t.used=!0,t.target},Lt[258]=e=>new Set(e),(Lt[259]=e=>(Ut.mapsAsObjects&&(Ut.mapsAsObjects=!1,Et=!0),e())).handlesRead=!0;Bt.push(((e,t)=>e>=225&&e<=255?ss(ns().prefixes[e-224],t):e>=28704&&e<=32767?ss(ns().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?ss(ns().prefixes[e-1879048192],t):e>=216&&e<=223?ss(t,ns().suffixes[e-216]):e>=27647&&e<=28671?ss(t,ns().suffixes[e-27639]):e>=1811940352&&e<=1879048191?ss(t,ns().suffixes[e-1811939328]):1399353956==e?{packedValues:_t,structures:vt.slice(0),version:t}:55799==e?t:void 0));const rs=1==new Uint8Array(new Uint16Array([1]).buffer)[0],os=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],is=[64,68,69,70,71,72,77,78,79,85,86];for(let $n=0;$n<os.length;$n++)as(os[$n],is[$n]);function as(e,t){let s,n="get"+e.name.slice(0,-5);"function"==typeof e?s=e.BYTES_PER_ELEMENT:e=null;for(let r=0;r<2;r++){if(!r&&1==s)continue;let o=2==s?1:4==s?2:8==s?3:0;Lt[r?t:t-4]=1==s||r==rs?n=>{if(!e)throw new Error("Could not find typed array for code "+t);return Ut.copyBuffers||1!==s&&(2!==s||1&n.byteOffset)&&(4!==s||3&n.byteOffset)&&(8!==s||7&n.byteOffset)?new e(Uint8Array.prototype.slice.call(n,0).buffer):new e(n.buffer,n.byteOffset,n.byteLength>>o)}:s=>{if(!e)throw new Error("Could not find typed array for code "+t);let i=new DataView(s.buffer,s.byteOffset,s.byteLength),a=s.length>>o,c=new e(a),h=i[n];for(let e=0;e<a;e++)c[e]=h.call(i,e<<o,r);return c}}}function cs(){let e=31&yt[mt++];if(e>23)switch(e){case 24:e=yt[mt++];break;case 25:e=xt.getUint16(mt),mt+=2;break;case 26:e=xt.getUint32(mt),mt+=4}return e}function hs(){if(Ut.getShared){let e=ds((()=>(yt=null,Ut.getShared())))||{},t=e.structures||[];Ut.sharedVersion=e.version,_t=Ut.sharedValues=e.packedValues,!0===vt?Ut.structures=vt=t:vt.splice.apply(vt,[0,t.length].concat(t))}}function ds(e){let t=gt,s=mt,n=Dt,r=Mt,o=Ot,i=St,a=kt,c=At,h=It,d=new Uint8Array(yt.slice(0,gt)),u=vt,l=Ut,f=Rt,p=e();return gt=t,mt=s,Dt=n,Mt=r,Ot=o,St=i,kt=a,At=c,It=h,yt=d,Rt=f,vt=u,Ut=l,xt=new DataView(yt.buffer,yt.byteOffset,yt.byteLength),p}function us(){yt=null,At=null,vt=null}const ls=new Array(147);for(let $n=0;$n<256;$n++)ls[$n]=+("1e"+Math.floor(45.15-.30103*$n));let fs=new $t({useRecords:!1});const ps=fs.decode;fs.decodeMultiple;let ys,gs,ms;try{ys=new TextEncoder}catch(Fn){}const bs="object"==typeof globalThis&&globalThis.Buffer,ws=void 0!==bs,vs=ws?bs.allocUnsafeSlow:Uint8Array,Ss=ws?bs:Uint8Array,Is=ws?4294967296:2144337920;let As,_s,xs,Es,Hs=0,Cs=null;const ks=/[\u0080-\uFFFF]/,Ds=Symbol("record-id");class Us extends $t{constructor(e){let t,s,n,r,o;super(e),this.offset=0,e=e||{};let i=Ss.prototype.utf8Write?function(e,t,s){return _s.utf8Write(e,t,s)}:!(!ys||!ys.encodeInto)&&function(e,t){return ys.encodeInto(e,_s.subarray(t)).written},a=this,c=e.structures||e.saveStructures,h=e.maxSharedStructures;if(null==h&&(h=c?128:0),h>8190)throw new Error("Maximum maxSharedStructure is 8190");let d=e.sequential;d&&(h=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let u,l,f,p=e.sharedValues;if(p){f=Object.create(null);for(let e=0,t=p.length;e<t;e++)f[p[e]]=e}let y=[],g=0,m=0;this.mapEncode=function(e,t){if(this._keyMap&&!this._mapped&&"Array"===e.constructor.name)e=e.map((e=>this.encodeKeys(e)));return this.encode(e,t)},this.encode=function(i,c){if(_s||(_s=new vs(8192),xs=new DataView(_s.buffer,0,8192),Hs=0),Es=_s.length-10,Es-Hs<2048?(_s=new vs(_s.length),xs=new DataView(_s.buffer,0,_s.length),Es=_s.length-10,Hs=0):c===Ws&&(Hs=Hs+7&2147483640),t=Hs,a.useSelfDescribedHeader&&(xs.setUint32(Hs,3654940416),Hs+=3),o=a.structuredClone?new Map:null,a.bundleStrings&&"string"!=typeof i?(Cs=[],Cs.size=1/0):Cs=null,s=a.structures,s){if(s.uninitialized){let e=a.getShared()||{};a.structures=s=e.structures||[],a.sharedVersion=e.version;let t=a.sharedValues=e.packedValues;if(t){f={};for(let e=0,s=t.length;e<s;e++)f[t[e]]=e}}let e=s.length;if(e>h&&!d&&(e=h),!s.transitions){s.transitions=Object.create(null);for(let t=0;t<e;t++){let e=s[t];if(!e)continue;let n,r=s.transitions;for(let s=0,o=e.length;s<o;s++){void 0===r[Ds]&&(r[Ds]=t);let o=e[s];n=r[o],n||(n=r[o]=Object.create(null)),r=n}r[Ds]=1048576|t}}d||(s.nextId=e)}if(n&&(n=!1),r=s||[],l=f,e.pack){let t=new Map;if(t.values=[],t.encoder=a,t.maxValues=e.maxPrivatePackedValues||(f?16:1/0),t.objectMap=f||!1,t.samplingPackedValues=u,Rs(i,t),t.values.length>0){_s[Hs++]=216,_s[Hs++]=51,Ls(4);let e=t.values;b(e),Ls(0),Ls(0),l=Object.create(f||null);for(let t=0,s=e.length;t<s;t++)l[e[t]]=t}}As=c&qs;try{if(As)return;if(b(i),Cs&&js(t,b),a.offset=Hs,o&&o.idsToInsert){Hs+=2*o.idsToInsert.length,Hs>Es&&v(Hs),a.offset=Hs;let e=function(e,t){let s,n=2*t.length,r=e.length-n;t.sort(((e,t)=>e.offset>t.offset?1:-1));for(let o=0;o<t.length;o++){let s=t[o];s.id=o;for(let t of s.references)e[t++]=o>>8,e[t]=255&o}for(;s=t.pop();){let t=s.offset;e.copyWithin(t+n,t,r),n-=2;let o=t+n;e[o++]=216,e[o++]=28,r=t}return e}(_s.subarray(t,Hs),o.idsToInsert);return o=null,e}return c&Ws?(_s.start=t,_s.end=Hs,_s):_s.subarray(t,Hs)}finally{if(s)if(m<10&&m++,s.length>h&&(s.length=h),g>1e4)s.transitions=null,m=0,g=0,y.length>0&&(y=[]);else if(y.length>0&&!d){for(let e=0,t=y.length;e<t;e++)y[e][Ds]=void 0;y=[]}if(n&&a.saveShared){a.structures.length>h&&(a.structures=a.structures.slice(0,h));let e=_s.subarray(t,Hs);return!1===a.updateSharedData()?a.encode(i):e}c&Js&&(Hs=t)}},this.findCommonStringsToPack=()=>(u=new Map,f||(f=Object.create(null)),e=>{let t=e&&e.threshold||4,s=this.pack?e.maxPrivatePackedValues||16:0;p||(p=this.sharedValues=[]);for(let[r,o]of u)o.count>t&&(f[r]=s++,p.push(r),n=!0);for(;this.saveShared&&!1===this.updateSharedData(););u=null});const b=s=>{Hs>Es&&(_s=v(Hs));var n,r=typeof s;if("string"===r){if(l){let t=l[s];if(t>=0)return void(t<16?_s[Hs++]=t+224:(_s[Hs++]=198,b(1&t?15-t>>1:t-16>>1)));if(u&&!e.pack){let e=u.get(s);e?e.count++:u.set(s,{count:1})}}let r,o=s.length;if(Cs&&o>=4&&o<1024){if((Cs.size+=o)>61440){let e,s=(Cs[0]?3*Cs[0].length+Cs[1].length:0)+10;Hs+s>Es&&(_s=v(Hs+s)),_s[Hs++]=217,_s[Hs++]=223,_s[Hs++]=249,_s[Hs++]=Cs.position?132:130,_s[Hs++]=26,e=Hs-t,Hs+=4,Cs.position&&js(t,b),Cs=["",""],Cs.size=0,Cs.position=e}let e=ks.test(s);return Cs[e?0:1]+=s,_s[Hs++]=e?206:207,void b(o)}r=o<32?1:o<256?2:o<65536?3:5;let a=3*o;if(Hs+a>Es&&(_s=v(Hs+a)),o<64||!i){let e,t,i,a=Hs+r;for(e=0;e<o;e++)t=s.charCodeAt(e),t<128?_s[a++]=t:t<2048?(_s[a++]=t>>6|192,_s[a++]=63&t|128):55296==(64512&t)&&56320==(64512&(i=s.charCodeAt(e+1)))?(t=65536+((1023&t)<<10)+(1023&i),e++,_s[a++]=t>>18|240,_s[a++]=t>>12&63|128,_s[a++]=t>>6&63|128,_s[a++]=63&t|128):(_s[a++]=t>>12|224,_s[a++]=t>>6&63|128,_s[a++]=63&t|128);n=a-Hs-r}else n=i(s,Hs+r,a);n<24?_s[Hs++]=96|n:n<256?(r<2&&_s.copyWithin(Hs+2,Hs+1,Hs+1+n),_s[Hs++]=120,_s[Hs++]=n):n<65536?(r<3&&_s.copyWithin(Hs+3,Hs+2,Hs+2+n),_s[Hs++]=121,_s[Hs++]=n>>8,_s[Hs++]=255&n):(r<5&&_s.copyWithin(Hs+5,Hs+3,Hs+3+n),_s[Hs++]=122,xs.setUint32(Hs,n),Hs+=4),Hs+=n}else if("number"===r)if(this.alwaysUseFloat||s>>>0!==s)if(this.alwaysUseFloat||(s|0)!==s){let e;if((e=this.useFloat32)>0&&s<4294967296&&s>=-2147483648){let t;if(_s[Hs++]=250,xs.setFloat32(Hs,s),e<4||((t=s*ls[(127&_s[Hs])<<1|_s[Hs+1]>>7])|0)===t)return void(Hs+=4);Hs--}_s[Hs++]=251,xs.setFloat64(Hs,s),Hs+=8}else s>=-24?_s[Hs++]=31-s:s>=-256?(_s[Hs++]=56,_s[Hs++]=~s):s>=-65536?(_s[Hs++]=57,xs.setUint16(Hs,~s),Hs+=2):(_s[Hs++]=58,xs.setUint32(Hs,~s),Hs+=4);else s<24?_s[Hs++]=s:s<256?(_s[Hs++]=24,_s[Hs++]=s):s<65536?(_s[Hs++]=25,_s[Hs++]=s>>8,_s[Hs++]=255&s):(_s[Hs++]=26,xs.setUint32(Hs,s),Hs+=4);else if("object"===r)if(s){if(o){let e=o.get(s);if(e){if(_s[Hs++]=216,_s[Hs++]=29,_s[Hs++]=25,!e.references){let t=o.idsToInsert||(o.idsToInsert=[]);e.references=[],t.push(e)}return e.references.push(Hs-t),void(Hs+=2)}o.set(s,{offset:Hs-t})}let e=s.constructor;if(e===Object)w(s);else if(e===Array){(n=s.length)<24?_s[Hs++]=128|n:Ls(n);for(let e=0;e<n;e++)b(s[e])}else if(e===Map)if((this.mapsAsObjects?!1!==this.useTag259ForMaps:this.useTag259ForMaps)&&(_s[Hs++]=217,_s[Hs++]=1,_s[Hs++]=3),(n=s.size)<24?_s[Hs++]=160|n:n<256?(_s[Hs++]=184,_s[Hs++]=n):n<65536?(_s[Hs++]=185,_s[Hs++]=n>>8,_s[Hs++]=255&n):(_s[Hs++]=186,xs.setUint32(Hs,n),Hs+=4),a.keyMap)for(let[t,n]of s)b(a.encodeKey(t)),b(n);else for(let[t,n]of s)b(t),b(n);else{for(let e=0,t=gs.length;e<t;e++){if(s instanceof ms[e]){let t=gs[e],n=t.tag;return null==n&&(n=t.getTag&&t.getTag.call(this,s)),n<24?_s[Hs++]=192|n:n<256?(_s[Hs++]=216,_s[Hs++]=n):n<65536?(_s[Hs++]=217,_s[Hs++]=n>>8,_s[Hs++]=255&n):n>-1&&(_s[Hs++]=218,xs.setUint32(Hs,n),Hs+=4),void t.encode.call(this,s,b,v)}}if(s[Symbol.iterator]){if(As){let e=new Error("Iterable should be serialized as iterator");throw e.iteratorNotHandled=!0,e}_s[Hs++]=159;for(let e of s)b(e);return void(_s[Hs++]=255)}if(s[Symbol.asyncIterator]||Ps(s)){let e=new Error("Iterable/blob should be serialized as iterator");throw e.iteratorNotHandled=!0,e}if(this.useToJSON&&s.toJSON){const e=s.toJSON();if(e!==s)return b(e)}w(s)}}else _s[Hs++]=246;else if("boolean"===r)_s[Hs++]=s?245:244;else if("bigint"===r){if(s<BigInt(1)<<BigInt(64)&&s>=0)_s[Hs++]=27,xs.setBigUint64(Hs,s);else if(s>-(BigInt(1)<<BigInt(64))&&s<0)_s[Hs++]=59,xs.setBigUint64(Hs,-s-BigInt(1));else{if(!this.largeBigIntToFloat){s>=BigInt(0)?_s[Hs++]=194:(_s[Hs++]=195,s=BigInt(-1)-s);let e=[];for(;s;)e.push(Number(s&BigInt(255))),s>>=BigInt(8);return void Vs(new Uint8Array(e.reverse()),v)}_s[Hs++]=251,xs.setFloat64(Hs,Number(s))}Hs+=8}else{if("undefined"!==r)throw new Error("Unknown type: "+r);_s[Hs++]=247}},w=!1===this.useRecords?this.variableMapSize?e=>{let t=Object.keys(e),s=Object.values(e),n=t.length;if(n<24?_s[Hs++]=160|n:n<256?(_s[Hs++]=184,_s[Hs++]=n):n<65536?(_s[Hs++]=185,_s[Hs++]=n>>8,_s[Hs++]=255&n):(_s[Hs++]=186,xs.setUint32(Hs,n),Hs+=4),a.keyMap)for(let r=0;r<n;r++)b(a.encodeKey(t[r])),b(s[r]);else for(let r=0;r<n;r++)b(t[r]),b(s[r])}:e=>{_s[Hs++]=185;let s=Hs-t;Hs+=2;let n=0;if(a.keyMap)for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(a.encodeKey(t)),b(e[t]),n++);else for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(b(t),b(e[t]),n++);_s[s+++t]=n>>8,_s[s+t]=255&n}:(e,t)=>{let s,o,i,a=r.transitions||(r.transitions=Object.create(null)),c=0,d=0;if(this.keyMap){i=Object.keys(e).map((e=>this.encodeKey(e))),d=i.length;for(let e=0;e<d;e++){let t=i[e];s=a[t],s||(s=a[t]=Object.create(null),c++),a=s}}else for(let n in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(n))&&(s=a[n],s||(1048576&a[Ds]&&(o=65535&a[Ds]),s=a[n]=Object.create(null),c++),a=s,d++);let u=a[Ds];if(void 0!==u)u&=65535,_s[Hs++]=217,_s[Hs++]=u>>8|224,_s[Hs++]=255&u;else{if(i||(i=a.__keys__||(a.__keys__=Object.keys(e))),void 0===o?(u=r.nextId++,u||(u=0,r.nextId=1),u>=256&&(r.nextId=(u=h)+1)):u=o,r[u]=i,!(u<h)){if(a[Ds]=u,xs.setUint32(Hs,3655335680),Hs+=3,c&&(g+=m*c),y.length>=256-h&&(y.shift()[Ds]=void 0),y.push(a),Ls(d+2),b(57344+u),b(i),t)return;for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&b(e[t]);return}_s[Hs++]=217,_s[Hs++]=u>>8|224,_s[Hs++]=255&u,a=r.transitions;for(let e=0;e<d;e++)(void 0===a[Ds]||1048576&a[Ds])&&(a[Ds]=u),a=a[i[e]];a[Ds]=1048576|u,n=!0}if(d<24?_s[Hs++]=128|d:Ls(d),!t)for(let n in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(n))&&b(e[n])},v=e=>{let s;if(e>16777216){if(e-t>Is)throw new Error("Encoded buffer would be larger than maximum buffer size");s=Math.min(Is,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else s=1+(Math.max(e-t<<2,_s.length-1)>>12)<<12;let n=new vs(s);return xs=new DataView(n.buffer,0,s),_s.copy?_s.copy(n,0,t,e):n.set(_s.slice(t,e)),Hs-=t,t=0,Es=n.length-10,_s=n};let S=100,I=1e3;function*A(e,s,n){let r=e.constructor;if(r===Object){let t=!1!==a.useRecords;t?w(e,!0):Ms(Object.keys(e).length,160);for(let n in e){let r=e[n];t||b(n),r&&"object"==typeof r?s[n]?yield*A(r,s[n]):yield*_(r,s,n):b(r)}}else if(r===Array){let n=e.length;Ls(n);for(let r=0;r<n;r++){let n=e[r];n&&("object"==typeof n||Hs-t>S)?s.element?yield*A(n,s.element):yield*_(n,s,"element"):b(n)}}else if(e[Symbol.iterator]&&!e.buffer){_s[Hs++]=159;for(let n of e)n&&("object"==typeof n||Hs-t>S)?s.element?yield*A(n,s.element):yield*_(n,s,"element"):b(n);_s[Hs++]=255}else Ps(e)?(Ms(e.size,64),yield _s.subarray(t,Hs),yield e,x()):e[Symbol.asyncIterator]?(_s[Hs++]=159,yield _s.subarray(t,Hs),yield e,x(),_s[Hs++]=255):b(e);n&&Hs>t?yield _s.subarray(t,Hs):Hs-t>S&&(yield _s.subarray(t,Hs),x())}function*_(e,s,n){let r=Hs-t;try{b(e),Hs-t>S&&(yield _s.subarray(t,Hs),x())}catch(Fn){if(!Fn.iteratorNotHandled)throw Fn;s[n]={},Hs=t+r,yield*A.call(this,e,s[n])}}function x(){S=I,a.encode(null,qs)}function E(e,t,s){return S=t&&t.chunkThreshold?I=t.chunkThreshold:100,e&&"object"==typeof e?(a.encode(null,qs),s(e,a.iterateProperties||(a.iterateProperties={}),!0)):[a.encode(e)]}async function*H(e,t){for(let s of A(e,t,!0)){let e=s.constructor;if(e===Ss||e===Uint8Array)yield s;else if(Ps(s)){let e,t=s.stream().getReader();for(;!(e=await t.read()).done;)yield e.value}else if(s[Symbol.asyncIterator])for await(let n of s)x(),n?yield*H(n,t.async||(t.async={})):yield a.encode(n);else yield s}}this.encodeAsIterable=function(e,t){return E(e,t,A)},this.encodeAsAsyncIterable=function(e,t){return E(e,t,H)}}useBuffer(e){_s=e,xs=new DataView(_s.buffer,_s.byteOffset,_s.byteLength),Hs=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),s=new Os(t,this.sharedValues,this.sharedVersion),n=this.saveShared(s,(t=>(t&&t.version||0)==e));return!1===n?(s=this.getShared()||{},this.structures=s.structures||[],this.sharedValues=s.packedValues,this.sharedVersion=s.version,this.structures.nextId=this.structures.length):t.forEach(((e,t)=>this.structures[t]=e)),n}}function Ms(e,t){e<24?_s[Hs++]=t|e:e<256?(_s[Hs++]=24|t,_s[Hs++]=e):e<65536?(_s[Hs++]=25|t,_s[Hs++]=e>>8,_s[Hs++]=255&e):(_s[Hs++]=26|t,xs.setUint32(Hs,e),Hs+=4)}class Os{constructor(e,t,s){this.structures=e,this.packedValues=t,this.version=s}}function Ls(e){e<24?_s[Hs++]=128|e:e<256?(_s[Hs++]=152,_s[Hs++]=e):e<65536?(_s[Hs++]=153,_s[Hs++]=e>>8,_s[Hs++]=255&e):(_s[Hs++]=154,xs.setUint32(Hs,e),Hs+=4)}const Bs="undefined"==typeof Blob?function(){}:Blob;function Ps(e){if(e instanceof Bs)return!0;let t=e[Symbol.toStringTag];return"Blob"===t||"File"===t}function Rs(e,t){switch(typeof e){case"string":if(e.length>3){if(t.objectMap[e]>-1||t.values.length>=t.maxValues)return;let s=t.get(e);if(s)2==++s.count&&t.values.push(e);else if(t.set(e,{count:1}),t.samplingPackedValues){let s=t.samplingPackedValues.get(e);s?s.count++:t.samplingPackedValues.set(e,{count:1})}}break;case"object":if(e)if(e instanceof Array)for(let s=0,n=e.length;s<n;s++)Rs(e[s],t);else{let n=!t.encoder.useRecords;for(var s in e)e.hasOwnProperty(s)&&(n&&Rs(s,t),Rs(e[s],t))}break;case"function":console.log(e)}}const Fs=1==new Uint8Array(new Uint16Array([1]).buffer)[0];function $s(e,t){return!Fs&&t>1&&(e-=4),{tag:e,encode:function(e,t){let s=e.byteLength,n=e.byteOffset||0,r=e.buffer||e;t(ws?bs.from(r,n,s):new Uint8Array(r,n,s))}}}function Vs(e,t){let s=e.byteLength;s<24?_s[Hs++]=64+s:s<256?(_s[Hs++]=88,_s[Hs++]=s):s<65536?(_s[Hs++]=89,_s[Hs++]=s>>8,_s[Hs++]=255&s):(_s[Hs++]=90,xs.setUint32(Hs,s),Hs+=4),Hs+s>=_s.length&&t(Hs+s),_s.set(e.buffer?e:new Uint8Array(e),Hs),Hs+=s}function js(e,t){xs.setUint32(Cs.position+e,Hs-Cs.position-e+1);let s=Cs;Cs=null,t(s[0]),t(s[1])}ms=[Date,Set,Error,RegExp,Zt,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?function(){}:BigInt64Array,Float32Array,Float64Array,Os],gs=[{tag:1,encode(e,t){let s=e.getTime()/1e3;(this.useTimestamp32||0===e.getMilliseconds())&&s>=0&&s<4294967296?(_s[Hs++]=26,xs.setUint32(Hs,s),Hs+=4):(_s[Hs++]=251,xs.setFloat64(Hs,s),Hs+=8)}},{tag:258,encode(e,t){t(Array.from(e))}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag:e=>e.tag,encode(e,t){t(e.value)}},{encode(e,t,s){Vs(e,s)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||ws&&!1!==this.tagUint8Array))return 64},encode(e,t,s){Vs(e,s)}},$s(68,1),$s(69,2),$s(70,4),$s(71,8),$s(72,1),$s(77,2),$s(78,4),$s(79,8),$s(85,4),$s(86,8),{encode(e,t){let s=e.packedValues||[],n=e.structures||[];if(s.values.length>0){_s[Hs++]=216,_s[Hs++]=51,Ls(4);let e=s.values;t(e),Ls(0),Ls(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let t=0,s=e.length;t<s;t++)packedObjectMap[e[t]]=t}if(n){xs.setUint32(Hs,3655335424),Hs+=3;let s=n.slice(0);s.unshift(57344),s.push(new Zt(e.version,1399353956)),t(s)}else t(new Zt(e.version,1399353956))}}];let Ts=new Us({useRecords:!1});Ts.encode,Ts.encodeAsIterable,Ts.encodeAsAsyncIterable;const{NEVER:Ks,ALWAYS:Ns,DECIMAL_ROUND:zs,DECIMAL_FIT:Gs}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},Ws=512,Js=1024,qs=2048;function Ys(e){return new Us({tagUint8Array:!1,useRecords:!1}).encode(e)}function Qs(e){return ps(e)}const Zs=(e,t)=>((e,t)=>e.length===t.length&&e.every(((e,s)=>e===t[s])))(e,t);class Xs extends Error{constructor(e){super(e),this.name="TimeoutError"}}class en extends i.b{documentId;#e;#t;#s;#n=r.K2.init();#r=6e4;#o={};#i=new Map;constructor(e,t={}){super(),this.documentId=e,"timeoutDelay"in t&&t.timeoutDelay&&(this.#r=t.timeoutDelay),"heads"in t&&(this.#s=t.heads);const s=r.K2.init();this.#e=o(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);const n=this.#r,i=qe({types:{context:{},events:{}},actions:{onUpdate:Te((({context:e,event:t})=>{const s=e.doc;!function(e,t){const s=S(t);if(!s.includes(e.type)){const t=1===s.length?`type "${s[0]}"`:`one of types "${s.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(e)} to have ${t}`)}}(t,ln);const{callback:n}=t.payload;return{doc:n(s)}})),onDelete:Te((()=>(this.emit("delete",{handle:this}),{doc:r.K2.init()}))),onUnavailable:Te((()=>({doc:r.K2.init()}))),onUnload:Te((()=>({doc:r.K2.init()})))}}).createMachine({initial:"idle",context:{documentId:e,doc:s},on:{UPDATE:{actions:"onUpdate"},UNLOAD:".unloaded",DELETE:".deleted"},states:{idle:{on:{BEGIN:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready"},after:{[n]:"unavailable"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[n]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},unloaded:{entry:"onUnload",on:{RELOAD:"loading"}},deleted:{entry:"onDelete",type:"final"}}});this.#t=B(i),this.#t.subscribe((e=>{const t=this.#n,s=e.context.doc;this.#e(`\u2192 ${e.value} %o`,s),this.#a(t,s)})),this.#t.start(),this.begin()}get#c(){return this.#t?.getSnapshot().context.doc}get#h(){return this.#t?.getSnapshot().value}#d(e){const t=Array.isArray(e)?e:[e];return function(e,t,s){const n={...Ye,...s};return new Promise(((s,r)=>{const{signal:o}=n;if(o?.aborted)return void r(o.reason);let i=!1;const a=n.timeout===1/0?void 0:setTimeout((()=>{c(),r(new Error(`Timeout of ${n.timeout} ms exceeded`))}),n.timeout),c=()=>{clearTimeout(a),i=!0,u?.unsubscribe(),d&&o.removeEventListener("abort",d)};function h(e){t(e)&&(c(),s(e))}let d,u;h(e.getSnapshot()),i||(o&&(d=()=>{c(),r(o.reason)},o.addEventListener("abort",d)),u=e.subscribe({next:h,error:e=>{c(),r(e)},complete:()=>{c(),r(new Error("Actor terminated without satisfying predicate"))}}),i&&u.unsubscribe())}))}(this.#t,(e=>t.some((t=>e.matches(t)))),{timeout:2*this.#r})}#a(e,t){const s=r.K2.getHeads(e),n=r.K2.getHeads(t);if(!Zs(ut(n),ut(s))){this.emit("heads-changed",{handle:this,doc:t});const o=r.K2.diff(t,s,n);o.length>0&&this.emit("change",{handle:this,doc:t,patches:o,patchInfo:{before:e,after:t,source:"change"}}),this.isReady()||this.#t.send({type:un})}this.#n=t}get url(){return ot({documentId:this.documentId,heads:this.#s})}isReady=()=>this.inState(["ready"]);isUnloaded=()=>this.inState(["unloaded"]);isDeleted=()=>this.inState(["deleted"]);isUnavailable=()=>this.inState(["unavailable"]);inState=e=>e.some((e=>this.#t.getSnapshot().matches(e)));get state(){return this.#t.getSnapshot().value}async whenReady(e=["ready"]){await(async(e,t)=>{let s;const n=new Promise(((e,n)=>{s=setTimeout((()=>n(new Xs(`withTimeout: timed out after ${t}ms`))),t)}));try{return await Promise.race([e,n])}finally{clearTimeout(s)}})(this.#d(e),this.#r)}doc(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#s?r.K2.view(this.#c,lt(this.#s)):this.#c}docSync(){return console.warn("docSync is deprecated. Use doc() instead. This function will be removed as part of the 2.0 release."),this.doc()}heads(){if(!this.isReady())throw new Error("DocHandle is not ready");return this.#s?this.#s:ut(r.K2.getHeads(this.#c))}begin(){this.#t.send({type:hn})}history(){if(this.isReady())return r.K2.topoHistoryTraversal(this.#c).map((e=>ut([e])))}view(e){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling view().`);const t=JSON.stringify(e),s=this.#i.get(t);if(s)return s;const n=new en(this.documentId,{heads:e,timeoutDelay:this.#r});return n.update((()=>r.K2.clone(this.#c))),n.doneLoading(),this.#i.set(t,n),n}diff(e,t){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before calling diff().`);const s=this.#c;if(!s)throw new Error("Document not available");if(e instanceof en){if(!e.isReady())throw new Error("Cannot diff against a handle that isn't ready");const t=e.heads();if(!t)throw new Error("Other document's heads not available");const n=r.K2.merge(r.K2.clone(s),e.doc());return r.K2.diff(n,lt(this.heads()),lt(t))}const n=t?e:this.heads()||[],o=t||e;return r.K2.diff(s,lt(n),lt(o))}metadata(e){if(this.isReady())return e||(e=this.heads()[0]),r.K2.inspectChange(this.#c,lt([e])[0])||void 0}update(e){this.#t.send({type:ln,payload:{callback:e}})}doneLoading(){this.#t.send({type:un})}setRemoteHeads(e,t){this.#o[e]=t,this.emit("remote-heads",{storageId:e,heads:t})}getRemoteHeads(e){return this.#o[e]}change(e,t={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is in ${this.state} and not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#s)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);this.#t.send({type:ln,payload:{callback:s=>r.K2.change(s,t,e)}})}changeAt(e,t,s={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);if(this.#s)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);let n;return this.#t.send({type:ln,payload:{callback:o=>{const i=r.K2.changeAt(o,lt(e),s,t);return n=i.newHeads?ut(i.newHeads):void 0,i.newDoc}}}),n}merge(e){if(!this.isReady()||!e.isReady())throw new Error("Both handles must be ready to merge");if(this.#s)throw new Error(`DocHandle#${this.documentId} is in view-only mode at specific heads. Use clone() to create a new document from this state.`);const t=e.doc();this.update((e=>r.K2.merge(e,t)))}unavailable(){this.#t.send({type:gn})}request(){"loading"===this.#h&&this.#t.send({type:dn})}unload(){this.#t.send({type:fn})}reload(){this.#t.send({type:pn})}delete(){this.#t.send({type:yn})}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:new Uint8Array(Ys(e))})}metrics(){return r.K2.stats(this.#c)}}const{IDLE:tn,LOADING:sn,REQUESTING:nn,READY:rn,UNLOADED:on,DELETED:an,UNAVAILABLE:cn}={IDLE:"idle",LOADING:"loading",REQUESTING:"requesting",READY:"ready",UNLOADED:"unloaded",DELETED:"deleted",UNAVAILABLE:"unavailable"},hn="BEGIN",dn="REQUEST",un="DOC_READY",ln="UPDATE",fn="UNLOAD",pn="RELOAD",yn="DELETE",gn="DOC_UNAVAILABLE";class mn extends i.b{#u=new Map;#l=new Set;#f=new Map;#p=new Set;#y=new Map;#e=o("automerge-repo:remote-heads-subscriptions");subscribeToRemotes(e){this.#e("subscribeToRemotes",e);const t=[];for(const s of e)this.#l.has(s)||(this.#l.add(s),t.push(s));t.length>0&&this.emit("change-remote-subs",{add:t,peers:Array.from(this.#p)})}unsubscribeFromRemotes(e){this.#e("subscribeToRemotes",e);const t=[];for(const s of e)this.#l.has(s)&&(this.#l.delete(s),this.#f.has(s)||t.push(s));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#p)})}handleControlMessage(e){const t=[],s=[],n=[];if(this.#e("handleControlMessage",e),e.add)for(const r of e.add){let s=this.#f.get(r);(this.#l.has(r)||s)&&n.push(r),s||(s=new Set,this.#f.set(r,s),this.#l.has(r)||t.push(r)),s.add(e.senderId)}if(e.remove)for(const r of e.remove){const t=this.#f.get(r);t&&(t.delete(e.senderId),0!=t.size||this.#l.has(r)||s.push(r))}(t.length>0||s.length>0)&&this.emit("change-remote-subs",{peers:Array.from(this.#p),add:t,remove:s});for(const r of n){const t=this.#y.get(e.senderId);if(t)for(const s of t){const t=this.#u.get(s);if(!t)continue;const n=t.get(r);n&&this.emit("notify-remote-heads",{targetId:e.senderId,documentId:s,heads:n.heads,timestamp:n.timestamp,storageId:r})}}}handleRemoteHeads(e){this.#e("handleRemoteHeads",e);const t=this.#g(e);for(const s of t)this.#l.has(s.storageId)&&this.emit("remote-heads-changed",s);for(const s of t)for(const t of this.#p)t!==e.senderId&&this.emit("notify-remote-heads",{targetId:t,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId});for(const s of t){const e=this.#f.get(s.storageId);if(e)for(const t of e)this.#m(t,s.documentId)&&this.emit("notify-remote-heads",{targetId:t,documentId:s.documentId,heads:s.remoteHeads,timestamp:s.timestamp,storageId:s.storageId})}}handleImmediateRemoteHeadsChanged(e,t,s){this.#e("handleLocalHeadsChanged",e,t,s);const n=this.#u.get(e),r=Date.now();if(n){const e=n.get(t);(!e||e.timestamp<Date.now())&&n.set(t,{heads:s,timestamp:Date.now()})}else this.#u.set(e,new Map([[t,{heads:s,timestamp:r}]]));const o=this.#f.get(t);if(o)for(const i of o)this.#m(i,e)&&this.emit("notify-remote-heads",{targetId:i,documentId:e,heads:s,timestamp:r,storageId:t})}addGenerousPeer(e){this.#e("addGenerousPeer",e),this.#p.add(e),this.#l.size>0&&this.emit("change-remote-subs",{add:Array.from(this.#l),peers:[e]});for(const[t,s]of this.#u)for(const[n,{heads:r,timestamp:o}]of s)this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:r,timestamp:o,storageId:n})}removePeer(e){this.#e("removePeer",e);const t=[];this.#p.delete(e),this.#y.delete(e);for(const[s,n]of this.#f)n.has(e)&&(n.delete(e),0==n.size&&(t.push(s),this.#f.delete(s)));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#p)})}subscribePeerToDoc(e,t){let s=this.#y.get(e);s||(s=new Set,this.#y.set(e,s)),s.add(t);const n=this.#u.get(t);if(n)for(const[r,o]of n){const s=this.#f.get(r);s&&s.has(e)&&this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:o.heads,timestamp:o.timestamp,storageId:r})}}#m(e,t){const s=this.#y.get(e);return s&&s.has(t)}#g(e){const t=[],{documentId:s,newHeads:n}=e;for(const[r,{heads:o,timestamp:i}]of Object.entries(n)){if(!this.#l.has(r)&&!this.#f.has(r))continue;let e=this.#u.get(s);e||(e=new Map,this.#u.set(s,e));const n=e.get(r);n&&n.timestamp>=i||(e.set(r,{timestamp:i,heads:o}),t.push({documentId:s,storageId:r,remoteHeads:o,timestamp:i}))}return t}}const bn=(e,t)=>{let s,n,r=Date.now();return function(...o){s=r+t-Date.now(),clearTimeout(n),n=setTimeout((()=>{e(...o),r=Date.now()}),s)}},wn=e=>"doc-unavailable"===e.type,vn=e=>"request"===e.type,Sn=e=>"sync"===e.type,In=e=>"ephemeral"===e.type,An=e=>"remote-subscription-change"===e.type,_n=e=>"remote-heads-changed"===e.type;class xn extends i.b{peerId;peerMetadata;#e;#b={};#w=0;#v=Math.random().toString(36).slice(2);#S={};adapters=[];constructor(e,t,s){super(),this.peerId=t,this.peerMetadata=s,this.#e=o(`automerge-repo:network:${this.peerId}`),e.forEach((e=>this.addNetworkAdapter(e)))}disconnect(){this.adapters.forEach((e=>e.disconnect()))}reconnect(){this.adapters.forEach((e=>e.connect(this.peerId)))}addNetworkAdapter(e){this.adapters.push(e),e.on("peer-candidate",(({peerId:t,peerMetadata:s})=>{this.#e(`peer candidate: ${t} `),this.#b[t]||(this.#b[t]=e),this.emit("peer",{peerId:t,peerMetadata:s})})),e.on("peer-disconnected",(({peerId:e})=>{this.#e(`peer disconnected: ${e} `),delete this.#b[e],this.emit("peer-disconnected",{peerId:e})})),e.on("message",(e=>{var t;if(Sn(t=e)||In(t)||vn(t)||wn(t)||An(t)||_n(t))if(this.#e(`message from ${e.senderId}`),In(e)){const t=(e=>`${e.senderId}:${e.sessionId}`)(e);(void 0===this.#S[t]||e.count>this.#S[t])&&(this.#S[t]=e.count,this.emit("message",e))}else this.emit("message",e);else this.#e(`invalid message: ${JSON.stringify(e)}`)})),e.on("close",(()=>{this.#e("adapter closed"),Object.entries(this.#b).forEach((([t,s])=>{s===e&&delete this.#b[t]}))})),this.peerMetadata.then((t=>{e.connect(this.peerId,t)})).catch((e=>{this.#e("error connecting to network",e)}))}removeNetworkAdapter(e){this.adapters=this.adapters.filter((t=>t!==e)),e.disconnect()}send(e){const t=this.#b[e.targetId];if(!t)return void this.#e(`Tried to send message but peer not found: ${e.targetId}`);const s=(e=>"ephemeral"===e.type?"count"in e?e:{...e,count:++this.#w,sessionId:this.#v,senderId:this.peerId}:{...e,senderId:this.peerId})(e);this.#e("sending message %o",s),t.send(s)}isReady=()=>this.adapters.every((e=>e.isReady()));whenReady=async()=>Promise.all(this.adapters.map((e=>e.whenReady())))}function En(e){let t=0;e.forEach((e=>{t+=e.length}));const s=new Uint8Array(t);let n=0;return e.forEach((e=>{s.set(e,n),n+=e.length})),s}var Hn=s(1212);function Cn(e){const t=Hn.hash(e);return s=t,Array.from(s,(e=>e.toString(16).padStart(2,"0"))).join("");var s}class kn extends i.b{#I;#A=new Map;#_=new Map;#x=!1;#e=o("automerge-repo:storage-subsystem");constructor(e){super(),this.#I=e}async id(){const e=await this.#I.load(["storage-adapter-id"]);let t;return e?t=(new TextDecoder).decode(e):(t=Xe.A(),await this.#I.save(["storage-adapter-id"],(new TextEncoder).encode(t))),t}async load(e,t){const s=[e,t];return await this.#I.load(s)}async save(e,t,s){const n=[e,t];await this.#I.save(n,s)}async remove(e,t){const s=[e,t];await this.#I.remove(s)}async loadDocData(e){const t=await this.#I.loadRange([e,"snapshot"]),s=await this.#I.loadRange([e,"incremental"]),n=[],r=[];for(const o of t)void 0!==o.data&&(r.push({key:o.key,type:"snapshot",size:o.data.length}),n.push(o.data));for(const o of s)void 0!==o.data&&(r.push({key:o.key,type:"incremental",size:o.data.length}),n.push(o.data));return this.#_.set(e,r),0===n.length?null:En(n)}async loadDoc(e){const t=await this.loadDocData(e);if(!t)return null;const s=performance.now(),n=r.K2.loadIncremental(r.K2.init(),t),o=performance.now();return this.emit("document-loaded",{documentId:e,durationMillis:o-s,...r.K2.stats(n)}),this.#A.set(e,r.K2.getHeads(n)),n}async saveDoc(e,t){if(!this.#E(e,t))return;const s=this.#_.get(e)??[];this.#H(s)?await this.#C(e,t,s):await this.#k(e,t),this.#A.set(e,r.K2.getHeads(t))}async removeDoc(e){await this.#I.removeRange([e,"snapshot"]),await this.#I.removeRange([e,"incremental"]),await this.#I.removeRange([e,"sync-state"])}async#k(e,t){const s=r.K2.saveSince(t,this.#A.get(e)??[]);if(!(s&&s.length>0))return Promise.resolve();{const n=[e,"incremental",Cn(s)];this.#e(`Saving incremental ${n} for document ${e}`),await this.#I.save(n,s),this.#_.has(e)||this.#_.set(e,[]),this.#_.get(e).push({key:n,type:"incremental",size:s.length}),this.#A.set(e,r.K2.getHeads(t))}}async#C(e,t,s){this.#x=!0;const n=r.K2.save(t),o=function(e){const t=new TextEncoder;return Cn(En(e.map((e=>t.encode(e)))))}(r.K2.getHeads(t)),i=[e,"snapshot",o],a=new Set(s.map((e=>e.key)).filter((e=>e[2]!==o)));this.#e(`Saving snapshot ${i} for document ${e}`),this.#e(`deleting old chunks ${Array.from(a)}`),await this.#I.save(i,n);for(const r of a)await this.#I.remove(r);const c=this.#_.get(e)?.filter((e=>!a.has(e.key)))??[];c.push({key:i,type:"snapshot",size:n.length}),this.#_.set(e,c),this.#x=!1}async loadSyncState(e,t){const s=[e,"sync-state",t];try{const e=await this.#I.load(s);return e?r.K2.decodeSyncState(e):void 0}catch(n){return void this.#e(`Error loading sync state for ${e} from ${t}`)}}async saveSyncState(e,t,s){const n=[e,"sync-state",t];await this.#I.save(n,r.K2.encodeSyncState(s))}#E(e,t){const s=this.#A.get(e);if(!s)return!0;const n=r.K2.getHeads(t);return!Zs(ut(n),ut(s))}#H(e){if(this.#x)return!1;let t=0,s=0;for(const n of e)"snapshot"===n.type?t+=n.size:s+=n.size;return t<1024||s>=t}}class Dn extends i.b{}class Un extends Dn{#e;syncDebounceRate=100;#D=[];#U={};#M={};#O={};#L=[];#B;#P=!1;#R;#F;constructor({handle:e,peerId:t,onLoadSyncState:s}){super(),this.#B=t,this.#R=e,this.#F=s??(()=>Promise.resolve(void 0));const n=e.documentId.slice(0,5);this.#e=o(`automerge-repo:docsync:${n}`),e.on("change",bn((()=>this.#$()),this.syncDebounceRate)),e.on("ephemeral-message-outbound",(e=>this.#V(e))),(async()=>{this.#j()})()}get peerStates(){return this.#M}get documentId(){return this.#R.documentId}async#$(){try{await this.#R.whenReady();const e=this.#R.doc();this.#D.forEach((t=>this.#T(t,e)))}catch(e){console.log("sync with peers threw an exception")}}async#V({data:e}){this.#e("broadcastToPeers",this.#D),this.#D.forEach((t=>this.#K(t,e)))}#K(e,t){this.#e(`sendEphemeralMessage ->${e}`);const s={type:"ephemeral",targetId:e,documentId:this.#R.documentId,data:t};this.emit("message",s)}#N(e,t){this.#z(e),e in this.#M||(this.#M[e]="unknown");const s=this.#O[e];if(s)return void t(s);let n=this.#U[e];n||(this.#F(e).then((t=>{this.#G(e,t??r.K2.initSyncState())})).catch((t=>{this.#e(`Error loading sync state for ${e}: ${t}`)})),n=this.#U[e]=[]),n.push(t)}#z(e){this.#D.includes(e)||(this.#D.push(e),this.emit("open-doc",{documentId:this.documentId,peerId:e}))}#G(e,t){const s=this.#U[e];if(s)for(const n of s)n(t);delete this.#U[e],this.#O[e]=t}#W(e,t){this.#O[e]=t,this.emit("sync-state",{peerId:e,syncState:t,documentId:this.#R.documentId})}#T(e,t){this.#e(`sendSyncMessage ->${e}`),this.#N(e,(s=>{const[n,o]=r.K2.generateSyncMessage(t,s);if(o){this.#W(e,n);const s=0===r.K2.getHeads(t).length;this.#R.isReady()||!s||0!==n.sharedHeads.length||Object.values(this.#M).includes("has")||"unknown"!==this.#M[e]?this.emit("message",{type:"sync",targetId:e,data:o,documentId:this.#R.documentId}):this.emit("message",{type:"request",targetId:e,documentId:this.#R.documentId,data:o}),s||(this.#M[e]="has")}}))}hasPeer(e){return this.#D.includes(e)}async beginSync(e){this.#R.whenReady([rn,nn,cn]).then((()=>{this.#P=!0,this.#J()})).catch((e=>{console.log("caught whenready",e),this.#P=!0,this.#J()}));this.#D.some((e=>"has"==this.#M[e]))&&await this.#R.whenReady(),e.forEach((t=>{this.#N(t,(s=>{const n=r.K2.decodeSyncState(r.K2.encodeSyncState(s));this.#W(t,n),this.#R.whenReady([rn,nn,cn]).then((()=>{const s=this.#R.isReady()?this.#R.doc():r.K2.init(),n=e.every((e=>this.#M[e]in["unavailable","wants"]));void 0===s&&n||this.#T(t,s??r.K2.init())})).catch((e=>{this.#e(`Error loading doc for ${t}: ${e}`)}))}))}))}endSync(e){this.#e(`removing peer ${e}`),this.#D=this.#D.filter((t=>t!==e))}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":this.#M[e.senderId]="unavailable",this.#J();break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==this.#R.documentId)throw new Error("channelId doesn't match documentId");const{senderId:t,data:s}=e,n=ps(new Uint8Array(s));this.#R.emit("ephemeral-message",{handle:this.#R,senderId:t,message:n}),this.#D.forEach((s=>{s!==t&&this.emit("message",{...e,targetId:s})}))}receiveSyncMessage(e){if(e.documentId!==this.#R.documentId)throw new Error("channelId doesn't match documentId");this.#R.inState([rn,nn,cn])?(this.#j(),this.#q(e)):this.#L.push({message:e,received:new Date})}#q(e){vn(e)&&(this.#M[e.senderId]="wants"),this.#J(),r.K2.decodeSyncMessage(e.data).heads.length>0&&(this.#M[e.senderId]="has"),this.#N(e.senderId,(t=>{this.#R.update((s=>{const n=performance.now(),[o,i]=r.K2.receiveSyncMessage(s,t,e.data),a=performance.now();return this.emit("metrics",{type:"receive-sync-message",documentId:this.#R.documentId,durationMillis:a-n,...r.K2.stats(s)}),this.#W(e.senderId,i),this.#T(e.senderId,s),o})),this.#J()}))}#J(){this.#P&&this.#R.inState([nn])&&this.#D.every((e=>"unavailable"===this.#M[e]||"wants"===this.#M[e]))&&(this.#D.filter((e=>"wants"===this.#M[e])).forEach((e=>{const t={type:"doc-unavailable",documentId:this.#R.documentId,targetId:e};this.emit("message",t)})),this.#R.unavailable())}#j(){for(const e of this.#L)this.#q(e.message);this.#L=[]}metrics(){return{peers:this.#D,size:this.#R.metrics()}}}const Mn=o("automerge-repo:collectionsync");class On extends Dn{repo;#D=new Set;docSynchronizers={};#Y={};#Q;constructor(e,t=[]){super(),this.repo=e,this.#Q=t.map((e=>rt(e).documentId))}#Z(e){return this.docSynchronizers[e.documentId]||(this.docSynchronizers[e.documentId]=this.#X(e)),this.docSynchronizers[e.documentId]}#X(e){const t=new Un({handle:e,peerId:this.repo.networkSubsystem.peerId,onLoadSyncState:async t=>{if(!this.repo.storageSubsystem)return;const{storageId:s,isEphemeral:n}=this.repo.peerMetadataByPeerId[t]||{};return s&&!n?this.repo.storageSubsystem.loadSyncState(e.documentId,s):void 0}});return t.on("message",(e=>this.emit("message",e))),t.on("open-doc",(e=>this.emit("open-doc",e))),t.on("sync-state",(e=>this.emit("sync-state",e))),t.on("metrics",(e=>this.emit("metrics",e))),t}async#ee(e){const t=Array.from(this.#D),s=[];for(const n of t){await this.repo.sharePolicy(n,e)&&s.push(n)}return s}async receiveMessage(e){Mn(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const t=e.documentId;if(!t)throw new Error("received a message with an invalid documentId");if(this.#Q.includes(t))return this.emit("metrics",{type:"doc-denied",documentId:t}),void this.emit("message",{type:"doc-unavailable",documentId:t,targetId:e.senderId});this.#Y[t]=!0;const s=await this.repo.find(t,{allowableStates:["ready","unavailable","requesting"]}),n=this.#Z(s);n.receiveMessage(e);const r=await this.#ee(t);n.beginSync(r.filter((e=>!n.hasPeer(e))))}addDocument(e){if(this.#Y[e.documentId])return;const t=this.#Z(e);this.#ee(e.documentId).then((e=>{t.beginSync(e)}))}removeDocument(e){throw new Error("not implemented")}addPeer(e){if(Mn(`adding ${e} & synchronizing with them`),!this.#D.has(e)){this.#D.add(e);for(const t of Object.values(this.docSynchronizers)){const{documentId:s}=t;this.repo.sharePolicy(e,s).then((s=>{s&&t.beginSync([e])}))}}}removePeer(e){Mn(`removing peer ${e}`),this.#D.delete(e);for(const t of Object.values(this.docSynchronizers))t.endSync(e)}get peers(){return Array.from(this.#D)}metrics(){return Object.fromEntries(Object.entries(this.docSynchronizers).map((([e,t])=>[e,t.metrics()])))}}function Ln(e,t){let s=!1;return new Promise(((n,r)=>{t?.addEventListener("abort",(()=>{s||r(new DOMException("Operation aborted","AbortError"))}),{once:!0}),e.then((e=>{n(e)})).catch((e=>{r(e)})).finally((()=>{s=!0}))}))}function Bn(){return"peer-"+Math.random().toString(36).slice(4)}class Pn extends i.b{#e;networkSubsystem;storageSubsystem;saveDebounceRate=100;#te={};synchronizer;sharePolicy=async()=>!0;peerMetadataByPeerId={};#se=new mn;#ne=!1;#re={};constructor({storage:e,network:t=[],peerId:s=Bn(),sharePolicy:n,isEphemeral:r=void 0===e,enableRemoteHeadsGossiping:i=!1,denylist:a=[]}={}){super(),this.#ne=i,this.#e=o("automerge-repo:repo"),this.sharePolicy=n??this.sharePolicy,this.on("delete-document",(({documentId:e})=>{c&&c.removeDoc(e).catch((t=>{this.#e("error deleting document",{documentId:e,err:t})}))})),this.synchronizer=new On(this,a),this.synchronizer.on("message",(e=>{this.#e(`sending ${e.type} message to ${e.targetId}`),d.send(e)})),this.synchronizer.on("metrics",(e=>this.emit("doc-metrics",e))),this.#ne&&this.synchronizer.on("open-doc",(({peerId:e,documentId:t})=>{this.#se.subscribePeerToDoc(e,t)}));const c=e?new kn(e):void 0;c&&c.on("document-loaded",(e=>this.emit("doc-metrics",{type:"doc-loaded",...e}))),this.storageSubsystem=c;const h=(async()=>({storageId:await(c?.id()),isEphemeral:r}))(),d=new xn(t,s,h);this.networkSubsystem=d,d.on("peer",(async({peerId:e,peerMetadata:t})=>{this.#e("peer connected",{peerId:e}),t&&(this.peerMetadataByPeerId[e]={...t}),this.sharePolicy(e).then((t=>{t&&this.#ne&&this.#se.addGenerousPeer(e)})).catch((e=>{console.log("error in share policy",{err:e})})),this.synchronizer.addPeer(e)})),d.on("peer-disconnected",(({peerId:e})=>{this.synchronizer.removePeer(e),this.#se.removePeer(e)})),d.on("message",(async e=>{this.#oe(e)})),this.synchronizer.on("sync-state",(e=>{this.#ie(e);const t=this.#te[e.documentId],{storageId:s}=this.peerMetadataByPeerId[e.peerId]||{};if(!s)return;const n=t.getRemoteHeads(s);e.syncState.theirHeads&&(!n||!Zs(n,ut(e.syncState.theirHeads)))&&e.syncState.theirHeads&&(t.setRemoteHeads(s,ut(e.syncState.theirHeads)),s&&this.#ne&&this.#se.handleImmediateRemoteHeadsChanged(e.documentId,s,ut(e.syncState.theirHeads)))})),this.#ne&&(this.#se.on("notify-remote-heads",(e=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:e.targetId,documentId:e.documentId,newHeads:{[e.storageId]:{heads:e.heads,timestamp:e.timestamp}}})})),this.#se.on("change-remote-subs",(e=>{this.#e("change-remote-subs",e);for(const t of e.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:t,add:e.add,remove:e.remove})})),this.#se.on("remote-heads-changed",(e=>{this.#te[e.documentId].setRemoteHeads(e.storageId,e.remoteHeads)})))}#ae(e){const{storageSubsystem:t}=this;if(t){const s=({handle:e,doc:s})=>{t.saveDoc(e.documentId,s)};e.on("heads-changed",bn(s,this.saveDebounceRate))}this.synchronizer.addDocument(e)}#oe(e){switch(e.type){case"remote-subscription-change":this.#ne&&this.#se.handleControlMessage(e);break;case"remote-heads-changed":this.#ne&&this.#se.handleRemoteHeads(e);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.synchronizer.receiveMessage(e).catch((e=>{console.log("error receiving message",{err:e})}))}}#ce={};#ie(e){if(!this.storageSubsystem)return;const{storageId:t,isEphemeral:s}=this.peerMetadataByPeerId[e.peerId]||{};if(!t||s)return;let n=this.#ce[t];n||(n=this.#ce[t]=bn((({documentId:e,syncState:s})=>{this.storageSubsystem.saveSyncState(e,t,s)}),this.saveDebounceRate)),n(e)}#he({documentId:e}){if(this.#te[e])return this.#te[e];if(!e)throw new Error(`Invalid documentId ${e}`);const t=new en(e);return this.#te[e]=t,t}get handles(){return this.#te}get peers(){return this.synchronizer.peers}getStorageIdOfPeer(e){return this.peerMetadataByPeerId[e]?.storageId}create(e){const{documentId:t}=rt((()=>{const e=Xe.A(null,new Uint8Array(16));return ot({documentId:e})})()),s=this.#he({documentId:t});return this.#ae(s),s.update((()=>{let t;return t=e?r.K2.from(e):r.K2.emptyChange(r.K2.init()),t})),s.doneLoading(),s}clone(e){if(!e.isReady())throw new Error("Cloned handle is not yet in ready state.\n        (Try await handle.whenReady() first.)");const t=e.doc(),s=this.create();return s.update((()=>r.K2.clone(t))),s}findWithProgress(e,t={}){const{signal:s}=t,{documentId:n,heads:r}=it(e)?rt(e):{documentId:ft(e),heads:void 0};if(this.#te[n]){const t=this.#te[n];if(t.state===cn){return{state:"unavailable",error:new Error(`Document ${e} is unavailable`),handle:t}}if(t.state===an){return{state:"failed",error:new Error(`Document ${e} was deleted`),handle:t}}if(t.state===rn){return{state:"ready",handle:r?t.view(r):t}}}const o=this.#re[n];if(o){const e=this.#te[n];if(e&&(e.state===rn||e.state===cn||e.state===an||"loading"===e.state))return o}const i=this.#he({documentId:n}),a={state:"loading",progress:0,handle:i},c={subscribers:new Set,currentProgress:void 0,notify:e=>{c.currentProgress=e,c.subscribers.forEach((t=>t(e))),this.#re[n]=e},peek:()=>c.currentProgress||a,subscribe:e=>(c.subscribers.add(e),()=>c.subscribers.delete(e))};c.notify(a),this.#de(e,n,i,c,s?Ln(new Promise((()=>{})),s):new Promise((()=>{})));const h={...a,peek:c.peek,subscribe:c.subscribe};return this.#re[n]=h,h}async#de(e,t,s,n,r){try{n.notify({state:"loading",progress:25,handle:s});const t=await(this.storageSubsystem?this.storageSubsystem.loadDoc(s.documentId):Promise.resolve(null)),o=await Promise.race([t,r]);if(o?(s.update((()=>o)),s.doneLoading(),n.notify({state:"loading",progress:50,handle:s})):(await Promise.race([this.networkSubsystem.whenReady(),r]),s.request(),n.notify({state:"loading",progress:75,handle:s})),this.#ae(s),await Promise.race([s.whenReady([rn,cn]),r]),s.state===cn){const e={state:"unavailable",handle:s};return void n.notify(e)}if(s.state===an)throw new Error(`Document ${e} was deleted`);n.notify({state:"ready",handle:s})}catch(Fn){n.notify({state:"failed",error:Fn instanceof Error?Fn:new Error(String(Fn)),handle:this.#he({documentId:t})})}}async find(e,t={}){const{allowableStates:s=["ready"],signal:n}=t;if(n?.aborted)throw new Error("Operation aborted");const r=this.findWithProgress(e,{signal:n});return"subscribe"in r?(this.#ae(r.handle),new Promise(((t,n)=>{const o=r.subscribe((r=>{s.includes(r.handle.state)?(o(),t(r.handle)):"unavailable"===r.state?(o(),n(new Error(`Document ${e} is unavailable`))):"failed"===r.state&&(o(),n(r.error))}))}))):(r.handle.state===rn||await r.handle.whenReady([rn,cn]),r.handle)}async#ue(e){if(this.#te[e])return this.#te[e];const t=this.#he({documentId:e}),s=await(this.storageSubsystem?this.storageSubsystem.loadDoc(t.documentId):Promise.resolve(null));return s?(t.update((()=>s)),t.doneLoading()):(await this.networkSubsystem.whenReady(),t.request()),this.#ae(t),t}async findClassic(e,t={}){const s=ft(e),{allowableStates:n,signal:r}=t;return Ln((async()=>{const t=await this.#ue(s);if(!n&&(await t.whenReady([rn,cn]),t.state===cn&&!r?.aborted))throw new Error(`Document ${e} is unavailable`);return t})(),r)}delete(e){const t=ft(e);this.#he({documentId:t}).delete(),delete this.#te[t],delete this.#re[t],this.emit("delete-document",{documentId:t})}async export(e){const t=ft(e),s=this.#he({documentId:t}).doc();return r.K2.save(s)}import(e){const t=r.K2.load(e),s=this.create();return s.update((()=>r.K2.clone(t))),s}subscribeToRemotes=e=>{this.#ne?(this.#e("subscribeToRemotes",{remotes:e}),this.#se.subscribeToRemotes(e)):this.#e("WARN: subscribeToRemotes called but remote heads gossiping is not enabled")};storageId=async()=>this.storageSubsystem?this.storageSubsystem.id():void 0;async flush(e){if(!this.storageSubsystem)return;const t=e?e.map((e=>this.#te[e])):Object.values(this.#te);await Promise.all(t.map((async e=>this.storageSubsystem.saveDoc(e.documentId,e.doc()))))}async removeFromCache(e){if(!this.#te[e])return void this.#e(`WARN: removeFromCache called but handle not found in handleCache for documentId: ${e}`);const t=this.#he({documentId:e});await t.whenReady([rn,on,an,cn]);t.doc()?(t.isReady()?t.unload():this.#e(`WARN: removeFromCache called but handle for documentId: ${e} in unexpected state: ${t.state}`),delete this.#te[e]):this.#e(`WARN: removeFromCache called but doc undefined for documentId: ${e}`)}shutdown(){return this.networkSubsystem.adapters.forEach((e=>{e.disconnect()})),this.flush()}metrics(){return{documents:this.synchronizer.metrics()}}}class Rn extends i.b{peerId;peerMetadata}r.K2.Counter,r.K2.RawString,r.K2.RawString,r.K2.getChanges,r.K2.getAllChanges,r.K2.applyChanges,r.K2.view,r.K2.getConflicts,r.K2.getCursor,r.K2.getCursorPosition,r.K2.splice,r.K2.updateText,r.K2.insertAt,r.K2.deleteAt,r.K2.mark,r.K2.unmark,r.K2.isRawString,r.K2.isRawString},1011:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha224=t.SHA224=t.sha256=t.SHA256=void 0;const n=s(1691);t.SHA256=n.SHA256,t.sha256=n.sha256,t.SHA224=n.SHA224,t.sha224=n.sha224},1212:function(e,t,s){var n;!function(){var t={};!function(e){"use strict";e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(e,s,n,r,o){for(var i,a,c,h,d,u,l,f,p,y,g,m,b;o>=64;){for(i=s[0],a=s[1],c=s[2],h=s[3],d=s[4],u=s[5],l=s[6],f=s[7],y=0;y<16;y++)g=r+4*y,e[y]=(255&n[g])<<24|(255&n[g+1])<<16|(255&n[g+2])<<8|255&n[g+3];for(y=16;y<64;y++)m=((p=e[y-2])>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,b=((p=e[y-15])>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,e[y]=(m+e[y-7]|0)+(b+e[y-16]|0);for(y=0;y<64;y++)m=(((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+(d&u^~d&l)|0)+(f+(t[y]+e[y]|0)|0)|0,b=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&a^i&c^a&c)|0,f=l,l=u,u=d,d=h+m|0,h=c,c=a,a=i,i=m+b|0;s[0]+=i,s[1]+=a,s[2]+=c,s[3]+=h,s[4]+=d,s[5]+=u,s[6]+=l,s[7]+=f,r+=64,o-=64}return r}var n=function(){function t(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return t.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},t.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},t.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this.bytesHashed+=t,this.bufferLength>0){for(;this.bufferLength<64&&t>0;)this.buffer[this.bufferLength++]=e[n++],t--;64===this.bufferLength&&(s(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(t>=64&&(n=s(this.temp,this.state,e,n,t),t%=64);t>0;)this.buffer[this.bufferLength++]=e[n++],t--;return this},t.prototype.finish=function(e){if(!this.finished){var t=this.bytesHashed,n=this.bufferLength,r=t/536870912|0,o=t<<3,i=t%64<56?64:128;this.buffer[n]=128;for(var a=n+1;a<i-8;a++)this.buffer[a]=0;this.buffer[i-8]=r>>>24&255,this.buffer[i-7]=r>>>16&255,this.buffer[i-6]=r>>>8&255,this.buffer[i-5]=r>>>0&255,this.buffer[i-4]=o>>>24&255,this.buffer[i-3]=o>>>16&255,this.buffer[i-2]=o>>>8&255,this.buffer[i-1]=o>>>0&255,s(this.temp,this.state,this.buffer,0,i),this.finished=!0}for(a=0;a<8;a++)e[4*a+0]=this.state[a]>>>24&255,e[4*a+1]=this.state[a]>>>16&255,e[4*a+2]=this.state[a]>>>8&255,e[4*a+3]=this.state[a]>>>0&255;return this},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype._saveState=function(e){for(var t=0;t<this.state.length;t++)e[t]=this.state[t]},t.prototype._restoreState=function(e,t){for(var s=0;s<this.state.length;s++)this.state[s]=e[s];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},t}();e.Hash=n;var r=function(){function e(e){this.inner=new n,this.outer=new n,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var t=new Uint8Array(this.blockSize);if(e.length>this.blockSize)(new n).update(e).finish(t).clean();else for(var s=0;s<e.length;s++)t[s]=e[s];for(s=0;s<t.length;s++)t[s]^=54;this.inner.update(t);for(s=0;s<t.length;s++)t[s]^=106;this.outer.update(t),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(s=0;s<t.length;s++)t[s]=0}return e.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},e.prototype.clean=function(){for(var e=0;e<this.istate.length;e++)this.ostate[e]=this.istate[e]=0;this.inner.clean(),this.outer.clean()},e.prototype.update=function(e){return this.inner.update(e),this},e.prototype.finish=function(e){return this.outer.finished?this.outer.finish(e):(this.inner.finish(e),this.outer.update(e,this.digestLength).finish(e)),this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e}();function o(e){var t=(new n).update(e),s=t.digest();return t.clean(),s}function i(e,t){var s=new r(e).update(t),n=s.digest();return s.clean(),n}function a(e,t,s,n){var r=n[0];if(0===r)throw new Error("hkdf: cannot expand more");t.reset(),r>1&&t.update(e),s&&t.update(s),t.update(n),t.finish(e),n[0]++}e.HMAC=r,e.hash=o,e.default=o,e.hmac=i;var c=new Uint8Array(e.digestLength);function h(e,t,s,n){void 0===t&&(t=c),void 0===n&&(n=32);for(var o=new Uint8Array([1]),h=i(t,e),d=new r(h),u=new Uint8Array(d.digestLength),l=u.length,f=new Uint8Array(n),p=0;p<n;p++)l===u.length&&(a(u,d,s,o),l=0),f[p]=u[l++];return d.clean(),u.fill(0),o.fill(0),f}function d(e,t,s,n){for(var o=new r(e),i=o.digestLength,a=new Uint8Array(4),c=new Uint8Array(i),h=new Uint8Array(i),d=new Uint8Array(n),u=0;u*i<n;u++){var l=u+1;a[0]=l>>>24&255,a[1]=l>>>16&255,a[2]=l>>>8&255,a[3]=l>>>0&255,o.reset(),o.update(t),o.update(a),o.finish(h);for(var f=0;f<i;f++)c[f]=h[f];for(f=2;f<=s;f++){o.reset(),o.update(h).finish(h);for(var p=0;p<i;p++)c[p]^=h[p]}for(f=0;f<i&&u*i+f<n;f++)d[u*i+f]=c[f]}for(u=0;u<i;u++)c[u]=h[u]=0;for(u=0;u<4;u++)a[u]=0;return o.clean(),d}e.hkdf=h,e.pbkdf2=d}(t);var r=t.default;for(var o in t)r[o]=t[o];"object"==typeof e.exports?e.exports=r:void 0===(n=function(){return r}.call(t,s,t,e))||(e.exports=n)}()},1343:e=>{"use strict";var t=Object.prototype.hasOwnProperty,s="~";function n(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function o(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new r(n,o||e,i),c=s?s+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(s?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},a.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,i=new Array(o);r<o;r++)i[r]=n[r].fn;return i},a.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,r,o,i){var a=s?s+e:e;if(!this._events[a])return!1;var c,h,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,r),!0;case 5:return d.fn.call(d.context,t,n,r,o),!0;case 6:return d.fn.call(d.context,t,n,r,o,i),!0}for(h=1,c=new Array(u-1);h<u;h++)c[h-1]=arguments[h];d.fn.apply(d.context,c)}else{var l,f=d.length;for(h=0;h<f;h++)switch(d[h].once&&this.removeListener(e,d[h].fn,void 0,!0),u){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,t);break;case 3:d[h].fn.call(d[h].context,t,n);break;case 4:d[h].fn.call(d[h].context,t,n,r);break;default:if(!c)for(l=1,c=new Array(u-1);l<u;l++)c[l-1]=arguments[l];d[h].fn.apply(d[h].context,c)}}return!0},a.prototype.on=function(e,t,s){return o(this,e,t,s,!1)},a.prototype.once=function(e,t,s){return o(this,e,t,s,!0)},a.prototype.removeListener=function(e,t,n,r){var o=s?s+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||r&&!a.once||n&&a.context!==n||i(this,o);else{for(var c=0,h=[],d=a.length;c<d;c++)(a[c].fn!==t||r&&!a[c].once||n&&a[c].context!==n)&&h.push(a[c]);h.length?this._events[o]=1===h.length?h[0]:h:i(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&i(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,e.exports=a},1691:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha512_224=t.sha512_256=t.sha384=t.sha512=t.sha224=t.sha256=t.SHA512_256=t.SHA512_224=t.SHA384=t.SHA512=t.SHA224=t.SHA256=void 0;const n=s(7734),r=s(3842),o=s(11),i=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),a=new Uint32Array(64);class c extends n.HashMD{constructor(e=32){super(64,e,8,!1),this.A=0|n.SHA256_IV[0],this.B=0|n.SHA256_IV[1],this.C=0|n.SHA256_IV[2],this.D=0|n.SHA256_IV[3],this.E=0|n.SHA256_IV[4],this.F=0|n.SHA256_IV[5],this.G=0|n.SHA256_IV[6],this.H=0|n.SHA256_IV[7]}get(){const{A:e,B:t,C:s,D:n,E:r,F:o,G:i,H:a}=this;return[e,t,s,n,r,o,i,a]}set(e,t,s,n,r,o,i,a){this.A=0|e,this.B=0|t,this.C=0|s,this.D=0|n,this.E=0|r,this.F=0|o,this.G=0|i,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)a[n]=e.getUint32(t,!1);for(let n=16;n<64;n++){const e=a[n-15],t=a[n-2],s=(0,o.rotr)(e,7)^(0,o.rotr)(e,18)^e>>>3,r=(0,o.rotr)(t,17)^(0,o.rotr)(t,19)^t>>>10;a[n]=r+a[n-7]+s+a[n-16]|0}let{A:s,B:r,C:c,D:h,E:d,F:u,G:l,H:f}=this;for(let p=0;p<64;p++){const e=f+((0,o.rotr)(d,6)^(0,o.rotr)(d,11)^(0,o.rotr)(d,25))+(0,n.Chi)(d,u,l)+i[p]+a[p]|0,t=((0,o.rotr)(s,2)^(0,o.rotr)(s,13)^(0,o.rotr)(s,22))+(0,n.Maj)(s,r,c)|0;f=l,l=u,u=d,d=h+e|0,h=c,c=r,r=s,s=e+t|0}s=s+this.A|0,r=r+this.B|0,c=c+this.C|0,h=h+this.D|0,d=d+this.E|0,u=u+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(s,r,c,h,d,u,l,f)}roundClean(){(0,o.clean)(a)}destroy(){this.set(0,0,0,0,0,0,0,0),(0,o.clean)(this.buffer)}}t.SHA256=c;class h extends c{constructor(){super(28),this.A=0|n.SHA224_IV[0],this.B=0|n.SHA224_IV[1],this.C=0|n.SHA224_IV[2],this.D=0|n.SHA224_IV[3],this.E=0|n.SHA224_IV[4],this.F=0|n.SHA224_IV[5],this.G=0|n.SHA224_IV[6],this.H=0|n.SHA224_IV[7]}}t.SHA224=h;const d=(()=>r.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),u=(()=>d[0])(),l=(()=>d[1])(),f=new Uint32Array(80),p=new Uint32Array(80);class y extends n.HashMD{constructor(e=64){super(128,e,16,!1),this.Ah=0|n.SHA512_IV[0],this.Al=0|n.SHA512_IV[1],this.Bh=0|n.SHA512_IV[2],this.Bl=0|n.SHA512_IV[3],this.Ch=0|n.SHA512_IV[4],this.Cl=0|n.SHA512_IV[5],this.Dh=0|n.SHA512_IV[6],this.Dl=0|n.SHA512_IV[7],this.Eh=0|n.SHA512_IV[8],this.El=0|n.SHA512_IV[9],this.Fh=0|n.SHA512_IV[10],this.Fl=0|n.SHA512_IV[11],this.Gh=0|n.SHA512_IV[12],this.Gl=0|n.SHA512_IV[13],this.Hh=0|n.SHA512_IV[14],this.Hl=0|n.SHA512_IV[15]}get(){const{Ah:e,Al:t,Bh:s,Bl:n,Ch:r,Cl:o,Dh:i,Dl:a,Eh:c,El:h,Fh:d,Fl:u,Gh:l,Gl:f,Hh:p,Hl:y}=this;return[e,t,s,n,r,o,i,a,c,h,d,u,l,f,p,y]}set(e,t,s,n,r,o,i,a,c,h,d,u,l,f,p,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|s,this.Bl=0|n,this.Ch=0|r,this.Cl=0|o,this.Dh=0|i,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|d,this.Fl=0|u,this.Gh=0|l,this.Gl=0|f,this.Hh=0|p,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)f[r]=e.getUint32(t),p[r]=e.getUint32(t+=4);for(let u=16;u<80;u++){const e=0|f[u-15],t=0|p[u-15],s=r.rotrSH(e,t,1)^r.rotrSH(e,t,8)^r.shrSH(e,t,7),n=r.rotrSL(e,t,1)^r.rotrSL(e,t,8)^r.shrSL(e,t,7),o=0|f[u-2],i=0|p[u-2],a=r.rotrSH(o,i,19)^r.rotrBH(o,i,61)^r.shrSH(o,i,6),c=r.rotrSL(o,i,19)^r.rotrBL(o,i,61)^r.shrSL(o,i,6),h=r.add4L(n,c,p[u-7],p[u-16]),d=r.add4H(h,s,a,f[u-7],f[u-16]);f[u]=0|d,p[u]=0|h}let{Ah:s,Al:n,Bh:o,Bl:i,Ch:a,Cl:c,Dh:h,Dl:d,Eh:y,El:g,Fh:m,Fl:b,Gh:w,Gl:v,Hh:S,Hl:I}=this;for(let A=0;A<80;A++){const e=r.rotrSH(y,g,14)^r.rotrSH(y,g,18)^r.rotrBH(y,g,41),t=r.rotrSL(y,g,14)^r.rotrSL(y,g,18)^r.rotrBL(y,g,41),_=y&m^~y&w,x=g&b^~g&v,E=r.add5L(I,t,x,l[A],p[A]),H=r.add5H(E,S,e,_,u[A],f[A]),C=0|E,k=r.rotrSH(s,n,28)^r.rotrBH(s,n,34)^r.rotrBH(s,n,39),D=r.rotrSL(s,n,28)^r.rotrBL(s,n,34)^r.rotrBL(s,n,39),U=s&o^s&a^o&a,M=n&i^n&c^i&c;S=0|w,I=0|v,w=0|m,v=0|b,m=0|y,b=0|g,({h:y,l:g}=r.add(0|h,0|d,0|H,0|C)),h=0|a,d=0|c,a=0|o,c=0|i,o=0|s,i=0|n;const O=r.add3L(C,D,M);s=r.add3H(O,H,k,U),n=0|O}({h:s,l:n}=r.add(0|this.Ah,0|this.Al,0|s,0|n)),({h:o,l:i}=r.add(0|this.Bh,0|this.Bl,0|o,0|i)),({h:a,l:c}=r.add(0|this.Ch,0|this.Cl,0|a,0|c)),({h:h,l:d}=r.add(0|this.Dh,0|this.Dl,0|h,0|d)),({h:y,l:g}=r.add(0|this.Eh,0|this.El,0|y,0|g)),({h:m,l:b}=r.add(0|this.Fh,0|this.Fl,0|m,0|b)),({h:w,l:v}=r.add(0|this.Gh,0|this.Gl,0|w,0|v)),({h:S,l:I}=r.add(0|this.Hh,0|this.Hl,0|S,0|I)),this.set(s,n,o,i,a,c,h,d,y,g,m,b,w,v,S,I)}roundClean(){(0,o.clean)(f,p)}destroy(){(0,o.clean)(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}t.SHA512=y;class g extends y{constructor(){super(48),this.Ah=0|n.SHA384_IV[0],this.Al=0|n.SHA384_IV[1],this.Bh=0|n.SHA384_IV[2],this.Bl=0|n.SHA384_IV[3],this.Ch=0|n.SHA384_IV[4],this.Cl=0|n.SHA384_IV[5],this.Dh=0|n.SHA384_IV[6],this.Dl=0|n.SHA384_IV[7],this.Eh=0|n.SHA384_IV[8],this.El=0|n.SHA384_IV[9],this.Fh=0|n.SHA384_IV[10],this.Fl=0|n.SHA384_IV[11],this.Gh=0|n.SHA384_IV[12],this.Gl=0|n.SHA384_IV[13],this.Hh=0|n.SHA384_IV[14],this.Hl=0|n.SHA384_IV[15]}}t.SHA384=g;const m=Uint32Array.from([2352822216,424955298,1944164710,2312950998,502970286,855612546,1738396948,1479516111,258812777,2077511080,2011393907,79989058,1067287976,1780299464,286451373,2446758561]),b=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class w extends y{constructor(){super(28),this.Ah=0|m[0],this.Al=0|m[1],this.Bh=0|m[2],this.Bl=0|m[3],this.Ch=0|m[4],this.Cl=0|m[5],this.Dh=0|m[6],this.Dl=0|m[7],this.Eh=0|m[8],this.El=0|m[9],this.Fh=0|m[10],this.Fl=0|m[11],this.Gh=0|m[12],this.Gl=0|m[13],this.Hh=0|m[14],this.Hl=0|m[15]}}t.SHA512_224=w;class v extends y{constructor(){super(32),this.Ah=0|b[0],this.Al=0|b[1],this.Bh=0|b[2],this.Bl=0|b[3],this.Ch=0|b[4],this.Cl=0|b[5],this.Dh=0|b[6],this.Dl=0|b[7],this.Eh=0|b[8],this.El=0|b[9],this.Fh=0|b[10],this.Fl=0|b[11],this.Gh=0|b[12],this.Gl=0|b[13],this.Hh=0|b[14],this.Hl=0|b[15]}}t.SHA512_256=v,t.sha256=(0,o.createHasher)((()=>new c)),t.sha224=(0,o.createHasher)((()=>new h)),t.sha512=(0,o.createHasher)((()=>new y)),t.sha384=(0,o.createHasher)((()=>new g)),t.sha512_256=(0,o.createHasher)((()=>new v)),t.sha512_224=(0,o.createHasher)((()=>new w))},3842:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toBig=t.shrSL=t.shrSH=t.rotrSL=t.rotrSH=t.rotrBL=t.rotrBH=t.rotr32L=t.rotr32H=t.rotlSL=t.rotlSH=t.rotlBL=t.rotlBH=t.add5L=t.add5H=t.add4L=t.add4H=t.add3L=t.add3H=void 0,t.add=w,t.fromBig=r,t.split=o;const s=BigInt(2**32-1),n=BigInt(32);function r(e,t=!1){return t?{h:Number(e&s),l:Number(e>>n&s)}:{h:0|Number(e>>n&s),l:0|Number(e&s)}}function o(e,t=!1){const s=e.length;let n=new Uint32Array(s),o=new Uint32Array(s);for(let i=0;i<s;i++){const{h:s,l:a}=r(e[i],t);[n[i],o[i]]=[s,a]}return[n,o]}const i=(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0);t.toBig=i;const a=(e,t,s)=>e>>>s;t.shrSH=a;const c=(e,t,s)=>e<<32-s|t>>>s;t.shrSL=c;const h=(e,t,s)=>e>>>s|t<<32-s;t.rotrSH=h;const d=(e,t,s)=>e<<32-s|t>>>s;t.rotrSL=d;const u=(e,t,s)=>e<<64-s|t>>>s-32;t.rotrBH=u;const l=(e,t,s)=>e>>>s-32|t<<64-s;t.rotrBL=l;const f=(e,t)=>t;t.rotr32H=f;const p=(e,t)=>e;t.rotr32L=p;const y=(e,t,s)=>e<<s|t>>>32-s;t.rotlSH=y;const g=(e,t,s)=>t<<s|e>>>32-s;t.rotlSL=g;const m=(e,t,s)=>t<<s-32|e>>>64-s;t.rotlBH=m;const b=(e,t,s)=>e<<s-32|t>>>64-s;function w(e,t,s,n){const r=(t>>>0)+(n>>>0);return{h:e+s+(r/2**32|0)|0,l:0|r}}t.rotlBL=b;const v=(e,t,s)=>(e>>>0)+(t>>>0)+(s>>>0);t.add3L=v;const S=(e,t,s,n)=>t+s+n+(e/2**32|0)|0;t.add3H=S;const I=(e,t,s,n)=>(e>>>0)+(t>>>0)+(s>>>0)+(n>>>0);t.add4L=I;const A=(e,t,s,n,r)=>t+s+n+r+(e/2**32|0)|0;t.add4H=A;const _=(e,t,s,n,r)=>(e>>>0)+(t>>>0)+(s>>>0)+(n>>>0)+(r>>>0);t.add5L=_;const x=(e,t,s,n,r,o)=>t+s+n+r+o+(e/2**32|0)|0;t.add5H=x;const E={fromBig:r,split:o,toBig:i,shrSH:a,shrSL:c,rotrSH:h,rotrSL:d,rotrBH:u,rotrBL:l,rotr32H:f,rotr32L:p,rotlSH:y,rotlSL:g,rotlBH:m,rotlBL:b,add:w,add3L:v,add3H:S,add4L:I,add4H:A,add5H:x,add5L:_};t.default=E},4008:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var n=s(6977);const r=function(e){if(!(0,n.A)(e))throw TypeError("Invalid UUID");let t;const s=new Uint8Array(16);return s[0]=(t=parseInt(e.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(e.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(e.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(e.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s}},4603:(e,t,s)=>{"use strict";s.a(e,(async(e,n)=>{try{s.d(t,{lc:()=>r.lc});var r=s(556),o=s(6378),i=e([o]);o=(i.then?(await i)():i)[0],n()}catch(a){n(a)}}))},4734:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))})),t.splice(r,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(s){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(s){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(65)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},6106:(e,t,s)=>{"use strict";var n=s(7250);e.exports=function(e){function t(t){var s=t.slice(0,-4),n=t.slice(-4),r=e(s);if(!(n[0]^r[0]|n[1]^r[1]|n[2]^r[2]|n[3]^r[3]))return s}return{encode:function(t){var s=Uint8Array.from(t),r=e(s),o=s.length+4,i=new Uint8Array(o);return i.set(s,0),i.set(r.subarray(0,4),s.length),n.encode(i,o)},decode:function(e){var s=t(n.decode(e));if(!s)throw new Error("Invalid checksum");return s},decodeUnsafe:function(e){var s=n.decodeUnsafe(e);if(s)return t(s)}}}},7250:(e,t,s)=>{const n=s(9923);e.exports=n("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},7734:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA512_IV=t.SHA384_IV=t.SHA224_IV=t.SHA256_IV=t.HashMD=void 0,t.setBigUint64=r,t.Chi=function(e,t,s){return e&t^~e&s},t.Maj=function(e,t,s){return e&t^e&s^t&s};const n=s(11);function r(e,t,s,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,s,n);const r=BigInt(32),o=BigInt(4294967295),i=Number(s>>r&o),a=Number(s&o),c=n?4:0,h=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+h,a,n)}class o extends n.Hash{constructor(e,t,s,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=r,this.buffer=new Uint8Array(e),this.view=(0,n.createView)(this.buffer)}update(e){(0,n.aexists)(this),e=(0,n.toBytes)(e),(0,n.abytes)(e);const{view:t,buffer:s,blockLen:r}=this,o=e.length;for(let i=0;i<o;){const a=Math.min(r-this.pos,o-i);if(a!==r)s.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=(0,n.createView)(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,n.aexists)(this),(0,n.aoutput)(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:o,isLE:i}=this;let{pos:a}=this;t[a++]=128,(0,n.clean)(this.buffer.subarray(a)),this.padOffset>o-a&&(this.process(s,0),a=0);for(let n=a;n<o;n++)t[n]=0;r(s,o-8,BigInt(8*this.length),i),this.process(s,0);const c=(0,n.createView)(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=h/4,u=this.get();if(d>u.length)throw new Error("_sha2: outputLen bigger than state");for(let n=0;n<d;n++)c.setUint32(4*n,u[n],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:n,finished:r,destroyed:o,pos:i}=this;return e.destroyed=o,e.finished=r,e.length=n,e.pos=i,n%t&&e.buffer.set(s),e}clone(){return this._cloneInto()}}t.HashMD=o,t.SHA256_IV=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),t.SHA224_IV=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),t.SHA384_IV=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),t.SHA512_IV=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209])},9049:e=>{var t=1e3,s=60*t,n=60*s,r=24*n,o=7*r,i=365.25*r;function a(e,t,s,n){var r=t>=1.5*s;return Math.round(e/s)+" "+n+(r?"s":"")}e.exports=function(e,c){c=c||{};var h=typeof e;if("string"===h&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*i;case"weeks":case"week":case"w":return c*o;case"days":case"day":case"d":return c*r;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*s;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===h&&isFinite(e))return c.long?function(e){var o=Math.abs(e);if(o>=r)return a(e,o,r,"day");if(o>=n)return a(e,o,n,"hour");if(o>=s)return a(e,o,s,"minute");if(o>=t)return a(e,o,t,"second");return e+" ms"}(e):function(e){var o=Math.abs(e);if(o>=r)return Math.round(e/r)+"d";if(o>=n)return Math.round(e/n)+"h";if(o>=s)return Math.round(e/s)+"m";if(o>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},9383:(e,t,s)=>{"use strict";var{sha256:n}=s(1011),r=s(6106);e.exports=r((function(e){return n(n(e))}))},9517:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.crypto=void 0,t.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0},9923:e=>{"use strict";e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var n=0;n<e.length;n++){var r=e.charAt(n),o=r.charCodeAt(0);if(255!==t[o])throw new TypeError(r+" is ambiguous");t[o]=n}var i=e.length,a=e.charAt(0),c=Math.log(i)/Math.log(256),h=Math.log(256)/Math.log(i);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var s=0,n=0,r=0;e[s]===a;)n++,s++;for(var o=(e.length-s)*c+1>>>0,h=new Uint8Array(o);e[s];){var d=e.charCodeAt(s);if(d>255)return;var u=t[d];if(255===u)return;for(var l=0,f=o-1;(0!==u||l<r)&&-1!==f;f--,l++)u+=i*h[f]>>>0,h[f]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");r=l,s++}for(var p=o-r;p!==o&&0===h[p];)p++;for(var y=new Uint8Array(n+(o-p)),g=n;p!==o;)y[g++]=h[p++];return y}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var s=0,n=0,r=0,o=t.length;r!==o&&0===t[r];)r++,s++;for(var c=(o-r)*h+1>>>0,d=new Uint8Array(c);r!==o;){for(var u=t[r],l=0,f=c-1;(0!==u||l<n)&&-1!==f;f--,l++)u+=256*d[f]>>>0,d[f]=u%i>>>0,u=u/i>>>0;if(0!==u)throw new Error("Non-zero carry");n=l,r++}for(var p=c-n;p!==c&&0===d[p];)p++;for(var y=a.repeat(s);p<c;++p)y+=e.charAt(d[p]);return y},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}}}]);