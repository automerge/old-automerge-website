"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5515],{3183:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>d,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"tutorial/load_by_url","title":"Load documents by URL","description":"We\'ve learned to create documents in the browser console using Repo.create and look them up by using Repo.find. But this is not a user interface. On the web we really want to be able to share links with each other, not munge around in the browser console. We\'re now going to introduce a simple trick for loading documents by URL which is great for prototyping - storing the document URL in the browser\'s location hash.","source":"@site/docs/tutorial/04-load_by_url.mdx","sourceDirName":"tutorial","slug":"/tutorial/load_by_url","permalink":"/docs/tutorial/load_by_url","draft":false,"unlisted":false,"editUrl":"https://github.com/automerge/automerge.github.io/edit/main/docs/tutorial/04-load_by_url.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Load documents by URL"},"sidebar":"tutorialSidebar","previous":{"title":"Local Storage & Sync","permalink":"/docs/tutorial/local-sync"},"next":{"title":"React Integration","permalink":"/docs/tutorial/react"}}');var i=n(4848),s=n(8453),a=(n(2362),n(5537),n(9329),n(3476));n(4903);const d={title:"Load documents by URL"},r=void 0,l={},c=[{value:"Find or create <code>DocHandle</code>",id:"find-or-create-dochandle",level:3},{value:"Testing DocHandle loading",id:"testing-dochandle-loading",level:3},{value:"Next Step",id:"next-step",level:3}];function h(e){const t={code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["We've learned to create documents in the browser console using ",(0,i.jsx)(t.code,{children:"Repo.create"})," and look them up by using ",(0,i.jsx)(t.code,{children:"Repo.find"}),". But this is not a user interface. On the web we really want to be able to share links with each other, not munge around in the browser console. We're now going to introduce a simple trick for loading documents by URL which is great for prototyping - storing the document URL in the browser's location hash."]}),"\n",(0,i.jsx)(t.p,{children:"What we're going to do is this:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"When the application loads, check if there is a document URL in the location hash"}),"\n",(0,i.jsx)(t.li,{children:"If there is, load that document"}),"\n",(0,i.jsx)(t.li,{children:"If there isn't, create a new document and put its URL in the location hash"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"The end result of this is that you can load the application and then share the URL with someone else and they'll be able to load the same document."}),"\n",(0,i.jsxs)(a.A,{children:[(0,i.jsxs)(t.h3,{id:"find-or-create-dochandle",children:["Find or create ",(0,i.jsx)(t.code,{children:"DocHandle"})]}),(0,i.jsxs)(t.p,{children:["Add the highlighted code to ",(0,i.jsx)(t.code,{children:"src/main.tsx"})," to load a document by URL or create a new one if it doesn't exist:"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-tsx",metastring:'title="src/main.tsx"',children:'import React, { Suspense } from "react";\nimport ReactDOM from "react-dom/client";\nimport App from "./components/App.tsx";\nimport "./index.css";\n\n// highlight-next-line\nimport { initTaskList, TaskList } from "./components/TaskList.tsx";\nimport {\n  Repo,\n  BroadcastChannelNetworkAdapter,\n  IndexedDBStorageAdapter,\n  // highlight-next-line\n  isValidAutomergeUrl,\n  // highlight-next-line\n  DocHandle,\n} from "@automerge/react";\n\nconst repo = new Repo({\n  network: [new BroadcastChannelNetworkAdapter()],\n  storage: new IndexedDBStorageAdapter(),\n});\n\n// Add the repo to the global window object so it can be accessed in the browser console\n// This is useful for debugging and testing purposes.\ndeclare global {\n  interface Window {\n    repo: Repo;\n    // highlight-start\n    // We also add the handle to the global window object for debugging\n    handle: DocHandle<TaskList>;\n    // highlight-end\n  }\n}\nwindow.repo = repo;\n\n// highlight-start\n// Check the URL for a document to load\nconst locationHash = document.location.hash.substring(1);\n// Depending if we have an AutomergeUrl, either find or create the document\nif (isValidAutomergeUrl(locationHash)) {\n  window.handle = await repo.find(locationHash);\n} else {\n  window.handle = repo.create<TaskList>(initTaskList());\n  // Set the location hash to the new document we just made.\n  document.location.hash = window.handle.url;\n}\n// highlight-end\n\nReactDOM.createRoot(document.getElementById("root")!).render(\n  <React.StrictMode>\n    <Suspense fallback={<div>Loading a document...</div>}>\n      <App taskList={initTaskList()} />\n    </Suspense>\n  </React.StrictMode>,\n);\n'})}),(0,i.jsxs)(t.p,{children:["Note that if the handle doesn't exist, we initialize it with ",(0,i.jsx)(t.code,{children:"initTaskList()"}),", which is a function that returns an initial task list structure. This will be useful in the next step when we integrate the document with our React components."]})]}),"\n",(0,i.jsx)(t.h3,{id:"testing-dochandle-loading",children:"Testing DocHandle loading"}),"\n",(0,i.jsxs)(t.p,{children:["Let's check this works. First, open the application at ",(0,i.jsx)(t.code,{children:"localhost:5173"}),". You should see that the URL of the browser gets updated to something like ",(0,i.jsx)(t.code,{children:"http://localhost:5173/#automerge:2mdM9TnM2sJgLhHhYjyBzfusSsyr"}),". Now, copy that URL and open it in a new tab. At this point we should have the same handle loaded in both tabs, lets check that."]}),"\n",(0,i.jsx)(t.p,{children:"In the first tab open the console and type:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"console.log(window.handle.doc())\n"})}),"\n",(0,i.jsx)(t.p,{children:"You should see a basic task list data structure"}),"\n",(0,i.jsx)(t.p,{children:"Now, in the second tab, open the console and type the same command. You should see that the title of the task list in the second tab is the same as in the first."}),"\n",(0,i.jsx)(t.p,{children:"We can even update the task list in one tab and see the changes reflected in the other tab. In the first tab type:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'window.handle.change(d => d.title = "My task list")\n'})}),"\n",(0,i.jsx)(t.p,{children:"Then in the second tab type:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"console.log(window.handle.doc().title)\n"})}),"\n",(0,i.jsx)(t.p,{children:'You should see that the title in the second tab has been updated to "My task list".'}),"\n",(0,i.jsx)(t.h3,{id:"next-step",children:"Next Step"}),"\n",(0,i.jsx)(t.p,{children:"Now that we can easily share documents by URL it's time to update our React application to store it's state in Automerge."})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3476:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var o=n(4848);function i({children:e}){return(0,o.jsxs)("div",{className:"exercise",children:[(0,o.jsx)("div",{className:"exercise-header",children:(0,o.jsx)("h3",{children:"Exercise"})}),(0,o.jsx)("div",{className:"exercise-content",children:e})]})}},4903:(e,t,n)=>{n.d(t,{A:()=>i});n(6540);var o=n(4848);function i({children:e}){return(0,o.jsxs)("div",{className:"solution",children:[(0,o.jsx)("div",{className:"solution-header",children:(0,o.jsx)("h4",{children:"Solution"})}),(0,o.jsx)("div",{className:"solution-content",children:e})]})}}}]);